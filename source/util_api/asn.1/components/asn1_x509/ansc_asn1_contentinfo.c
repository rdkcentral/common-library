/*
 * If not stated otherwise in this file or this component's Licenses.txt file the
 * following copyright and licenses apply:
 *
 * Copyright 2015 RDK Management
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
*/

/**********************************************************************
   Copyright [2014] [Cisco Systems, Inc.]
 
   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at
 
       http://www.apache.org/licenses/LICENSE-2.0
 
   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
**********************************************************************/

/**********************************************************************

    MODULE: ansc_asn1_ContentInfo.c

        ASN.1 ANSC Code Generated by Cisco Systems, Inc.

    ---------------------------------------------------------------

    DESCRIPTION:

        The ASN.1 objects implemented in this file

        *   ANSC_ASN1_CONTENTINFO
        *   ANSC_ASN1_DATA
        *   ANSC_ASN1_SIGNEDDATA
        *   ANSC_ASN1_DIGESTALGORITHMIDENTIFIERS
        *   ANSC_ASN1_CERTIFICATES
        *   ANSC_ASN1_CERTIFICATEREVOCATIONLISTS
        *   ANSC_ASN1_SIGNERINFOS
        *   ANSC_ASN1_SIGNERINFO
        *   ANSC_ASN1_ISSUERANDSERIALNUMBER
        *   ANSC_ASN1_DIGESTENCRYPTIONALGORITHMIDENTIFIER
        *   ANSC_ASN1_ENCRYPTEDDIGEST
        *   ANSC_ASN1_DIGESTINFO
        *   ANSC_ASN1_ENVELOPEDDATA
        *   ANSC_ASN1_RECIPIENTINFOS
        *   ANSC_ASN1_ENCRYPTEDCONTENTINFO
        *   ANSC_ASN1_RECIPIENTINFO
        *   ANSC_ASN1_ENCRYPTEDCONTENT
        *   ANSC_ASN1_PKCS7ENCRYPTEDKEY
        *   ANSC_ASN1_SIGNEDANDENVELOPEDDATA
        *   ANSC_ASN1_DIGESTEDDATA
        *   ANSC_ASN1_DIGEST
        *   ANSC_ASN1_ENCRYPTEDDATA
        *   ANSC_ASN1_CONTENTDATA


    ---------------------------------------------------------------

    ENVIRONMENT:

        platform independent

    ---------------------------------------------------------------

    AUTHOR:

        ASNMAGIC ANSC CODE GENERATOR 1.0

    ---------------------------------------------------------------

    REVISION HISTORY:

        *   05/07/2002  initial revision
        *   05/08/2002  two functions add added to ContentInfo object
        *   05/09/2002  more funcions are added to SignedData object
        *   08/08/2002  more apis for SignedData object

 **********************************************************************/

#include "ansc_asn1_advanced_local.h"

/**********************************************************************

 OBJECT -- ANSC_ASN1_CONTENTINFO

 ContentInfo ::= Sequence 
     {
                       contentType OID 
                           content [CON 0] ContentData OPT
     }

 **********************************************************************/

ANSC_HANDLE 
AnscAsn1CreateContentInfo
    (
        ANSC_HANDLE                 hReserved
    )
{
    UNREFERENCED_PARAMETER(hReserved);
    PANSC_ASN1_CONTENTINFO          pThisObject  = NULL;

    /*
     * Create the base ASN.1 object.
     */
    pThisObject = (PANSC_ASN1_CONTENTINFO)
        AnscAsn1CreateSequence
            (
                (ANSC_HANDLE)sizeof(ANSC_ASN1_CONTENTINFO)
            );

    if( pThisObject == NULL)
    {
        return (ANSC_HANDLE)NULL;
    }

    /*
     * Initialize the common variables and functions for this ASN.1 object.
     */
    pThisObject->SetClassName(pThisObject, "ANSC_ASN1_CONTENTINFO");
    pThisObject->SetName(pThisObject, "ContentInfo");

    pThisObject->Create             = AnscAsn1CreateContentInfo;
    pThisObject->CreateChildAttr    = AnscAsn1ContentInfoCreateChildAttr;
    pThisObject->GetChildName       = AnscAsn1ContentInfoGetChildName;
    pThisObject->CreateChildObject  = AnscAsn1ContentInfoCreateChildObject;

    pThisObject->GetSignedData      = AnscAsn1PKCS7GetSignedData;
    pThisObject->SetTypeAndData     = AnscAsn1PKCS7SetTypeAndData;

    pThisObject->uTotalChild        = 2;

    /*
     * Create all the children
     */
    pThisObject->CreateAllChildren(pThisObject);


    return (ANSC_HANDLE)pThisObject;
}

ANSC_HANDLE
AnscAsn1ContentInfoCreateChildObject
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    PANSC_ASN1_OBJECT               pThisObject      = NULL;
    PANSC_ASN1_SEQUENCE             pParent          = (PANSC_ASN1_SEQUENCE)hThisObject;

    switch( index )
    {

        case 0:

            pThisObject = AnscAsn1CreateOID(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
            }

            break;

        case 1:

            pThisObject = AnscAsn1CreateContentData(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
                pThisObject->bCanBeOptional = TRUE;
                pThisObject->bOptional = TRUE;
            }

            break;

    }

    return pThisObject;

}

PANSC_ATTR_OBJECT
AnscAsn1ContentInfoCreateChildAttr
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    PANSC_ATTR_OBJECT               pAttrObject  = NULL;

    switch ( index )
    {
        case 0:

                break;

        case 1:

                pAttrObject = (PANSC_ATTR_OBJECT)
                    AnscAsn1AttrCreate
                        (
                          CONTEXT_FORM,
                          0,
                          EXPLICIT_TYPE
                        );

                break;

    }

    return pAttrObject;

}

PCHAR
AnscAsn1ContentInfoGetChildName
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    switch ( index )
    {
        case 0:

            return"contentType";

        case 1:

            return"content";

    }

    return "";

}


/*
 *  Manually added functions;
 */
ANSC_HANDLE
AnscAsn1PKCS7GetSignedData
    (
        ANSC_HANDLE                 hThisObject
    )
{
    PANSC_ASN1_CONTENTINFO          pThisObject  = (PANSC_ASN1_CONTENTINFO)hThisObject;
    PANSC_ASN1_CHOICE               pContent;

    if( pThisObject == NULL)
    {
        return NULL;
    }

    pContent = (PANSC_ASN1_CHOICE)pThisObject->GetChildByIndex(pThisObject,1);

    if( pContent == NULL || pContent->bOptional)
    {
        return NULL;
    }

    if( pContent->lSelect != CONTENTDATA_MASK_SIGNEDDATA)
    {
        return NULL;
    }

    return pContent->hSelection;
}

void
AnscAsn1PKCS7SetTypeAndData
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       selType,
        ANSC_HANDLE                 hData
    )
{
    PANSC_ASN1_CONTENTINFO          pThisObject  = (PANSC_ASN1_CONTENTINFO)hThisObject;
    PANSC_ASN1_OIDEN                pOID;
    PANSC_ASN1_CHOICE               pContent;
    PCHAR                           pOIDString;

    if( pThisObject == NULL)
    {
        return;
    }

    pContent = (PANSC_ASN1_CHOICE)pThisObject->GetChildByIndex(pThisObject,1);

    if( pContent == NULL)
    {
        return ;
    }

    pOID     = (PANSC_ASN1_OIDEN)pThisObject->GetChildByIndex(pThisObject,0);

    if( pOID != NULL)
    {
        pOIDString = pContent->GetOIDValueByMask(pContent,selType);
        pOID->SetStringOIDValue(pOID, pOIDString);
    }
    
    if( hData == NULL)
    {
        pContent->bOptional = TRUE;
    }
    else
    {
        pContent->bOptional = FALSE;

        pContent->SetSelection(pContent, selType, hData);
    }
}

/**********************************************************************

 OBJECT -- ANSC_ASN1_DATA

 Data ::= OctetString 

 **********************************************************************/

ANSC_HANDLE 
AnscAsn1CreateData
    (
        ANSC_HANDLE                 hReserved
    )
{
    PANSC_ASN1_DATA                 pThisObject  = NULL;

    /*
     * Create the base ASN.1 object.
     */
    pThisObject = (PANSC_ASN1_DATA)
        AnscAsn1CreateOctetString
            (
                hReserved
            );

    if( pThisObject == NULL)
    {
        return (ANSC_HANDLE)NULL;
    }

    /*
     * Initialize the common variables and functions for this ASN.1 object.
     */
    pThisObject->SetClassName(pThisObject, "ANSC_ASN1_DATA");
    pThisObject->SetName(pThisObject, "Data");

    pThisObject->Create             = AnscAsn1CreateData;

    return (ANSC_HANDLE)pThisObject;
}

/**********************************************************************

 OBJECT -- ANSC_ASN1_SIGNEDDATA

 SignedData ::= Sequence 
     {
                           version Integer 
                  digestAlgorithms DigestAlgorithmIdentifiers 
                       contentInfo ContentInfo 
                      certificates [CON 0] IMP Certificates OPT
                              crls [CON 1] IMP CertificateRevocationLists OPT
                       signerInfos SignerInfos 
     }

 **********************************************************************/

ANSC_HANDLE 
AnscAsn1CreateSignedData
    (
        ANSC_HANDLE                 hReserved
    )
{
    UNREFERENCED_PARAMETER(hReserved);
    PANSC_ASN1_SIGNEDDATA           pThisObject  = NULL;

    /*
     * Create the base ASN.1 object.
     */
    pThisObject = (PANSC_ASN1_SIGNEDDATA)
        AnscAsn1CreateSequence
            (
                (ANSC_HANDLE)sizeof(ANSC_ASN1_SIGNEDDATA)
            );

    if( pThisObject == NULL)
    {
        return (ANSC_HANDLE)NULL;
    }

    /*
     * Initialize the common variables and functions for this ASN.1 object.
     */
    pThisObject->SetClassName(pThisObject, "ANSC_ASN1_SIGNEDDATA");
    pThisObject->SetName(pThisObject, "SignedData");

    pThisObject->Create             = AnscAsn1CreateSignedData;
    pThisObject->CreateChildAttr    = AnscAsn1SignedDataCreateChildAttr;
    pThisObject->GetChildName       = AnscAsn1SignedDataGetChildName;
    pThisObject->CreateChildObject  = AnscAsn1SignedDataCreateChildObject;

    pThisObject->AddCertificate     = AnscAsn1SignedDataAddCertificate;
    pThisObject->AddDigestAlgor     = AnscAsn1SignedDataAddDigestAlgor;
    pThisObject->GetCertificateByIndex
                                    = AnscAsn1SignedDataGetCertificateByIndex;
    pThisObject->GetSignedHandle    = AnscAsn1SignedDataGetSignedHandle;

    /*
     *  Add more apis on 08/08/2002
     */
    pThisObject->GetTotalCerts     = AnscAsn1SignedDataGetTotalCerts;
    pThisObject->SetSignedHandle   = AnscAsn1SignedDataSetSignedHandle;
    pThisObject->VerifyMessageDigest
                                   = AnscAsn1SignedDataVerifyMessageDigest;
    pThisObject->VerifyCertChain   = AnscAsn1SignedDataVerifyCertChain;
    pThisObject->GetFirstCertOfTheChain
                                   = AnscAsn1SignedDataGetFirstCertOfTheChain;
    pThisObject->GetLastCertOfTheChain
                                   = AnscAsn1SignedDataGetLastCertOfTheChain;
    pThisObject->LookingForIssuer  = AnscAsn1SignedDataLookinForIssuer;


    pThisObject->uTotalChild       = 6;

    /*
     * Create all the children
     */
    pThisObject->CreateAllChildren(pThisObject);


    return (ANSC_HANDLE)pThisObject;
}

ANSC_HANDLE
AnscAsn1SignedDataCreateChildObject
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    PANSC_ASN1_OBJECT               pThisObject      = NULL;
    PANSC_ASN1_SEQUENCE             pParent          = (PANSC_ASN1_SEQUENCE)hThisObject;

    switch( index )
    {

        case 0:

            pThisObject = AnscAsn1CreateInteger(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
                
                /* pThisObject->bCanBeOptional = TRUE;*/
                /* pThisObject->bOptional = TRUE; */
                ((PANSC_ASN1_INTEGER)pThisObject)->SetIntegerValue(pThisObject, 3);
            }

            break;

        case 1:

            pThisObject = AnscAsn1CreateDigestAlgorithmIdentifiers(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
                pThisObject->bCanBeOptional = TRUE;
                pThisObject->bOptional = TRUE;
            }

            break;

        case 2:

            pThisObject = AnscAsn1CreateContentInfo(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
            }

            break;

        case 3:

            pThisObject = AnscAsn1CreateCertificates(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
                pThisObject->bCanBeOptional = TRUE;
                pThisObject->bOptional = TRUE;
            }

            break;

        case 4:

            pThisObject = AnscAsn1CreateCertificateRevocationLists(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
                pThisObject->bCanBeOptional = TRUE;
                pThisObject->bOptional = TRUE;
            }


            break;

        case 5:

            pThisObject = AnscAsn1CreateSignerInfos(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
            }

            break;

    }

    return pThisObject;

}

PANSC_ATTR_OBJECT
AnscAsn1SignedDataCreateChildAttr
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    PANSC_ATTR_OBJECT               pAttrObject  = NULL;

    switch ( index )
    {
        case 0:
        case 1:
        case 2:
        case 5:

                break;

        case 3:

                pAttrObject = (PANSC_ATTR_OBJECT)
                    AnscAsn1AttrCreate
                        (
                          CONTEXT_FORM,
                          0,
                          IMPLICIT_TYPE
                        );

                break;

        case 4:

                pAttrObject = (PANSC_ATTR_OBJECT)
                    AnscAsn1AttrCreate
                        (
                          CONTEXT_FORM,
                          1,
                          IMPLICIT_TYPE
                        );

                break;

    }

    return pAttrObject;

}

PCHAR
AnscAsn1SignedDataGetChildName
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    switch ( index )
    {
        case 0:

            return"version";

        case 1:

            return"digestAlgorithms";

        case 2:

            return"contentInfo";

        case 3:

            return"certificates";

        case 4:

            return"crls";

        case 5:

            return"signerInfos";

    }

    return "";

}


/*
 *  Manually added functions;
 */
ANSC_STATUS
AnscAsn1SignedDataAddDigestAlgor
    (
        ANSC_HANDLE                 hThisObject,
        PCHAR                       pOIDString
    )
{
    PANSC_ASN1_SIGNEDDATA           pThisObject  = (PANSC_ASN1_SIGNEDDATA)hThisObject;
    PANSC_ASN1_OIDEN                pOIDObject;
    PANSC_ASN1_PARAMETERS           pParams;
    ULONG                           i;
    CHAR                            pOID[128]    = { 0 };
    PANSC_ASN1_DIGESTALGORITHMIDENTIFIERS 
                                    pDigests     = NULL;
    PANSC_ASN1_DIGESTALGORITHMIDENTIFIER
                                    pNewObject;

    if( pThisObject == NULL || pOIDString == NULL || AnscSizeOfString(pOIDString) == 0)
    {
        return ANSC_STATUS_FAILURE;
    }

    pDigests = (PANSC_ASN1_DIGESTALGORITHMIDENTIFIERS)
        pThisObject->GetChildByIndex(pThisObject,1);

    if( pDigests == NULL)
    {
        return ANSC_STATUS_FAILURE;
    }

    /* check the same digest alg exists or not */
    for( i = 0; i < pDigests->GetChildCount(pDigests); i ++)
    {
        pNewObject = (PANSC_ASN1_DIGESTALGORITHMIDENTIFIER)
            pDigests->GetChildByIndex(pDigests, i);

        if( pNewObject != NULL)
        {
            pNewObject->GetAlgorOIDStringValue(pNewObject, pOID);

            if( strcasecmp( pOID, pOIDString) == 0 )
            {
                /* already added */
                return ANSC_STATUS_SUCCESS;
            }
        }
    }

    /* so add it here */
    pDigests->bOptional = FALSE;

    pNewObject = (PANSC_ASN1_DIGESTALGORITHMIDENTIFIER)pDigests->CreateChild(pDigests, TRUE);

    if( pNewObject == NULL)
    {
        return ANSC_STATUS_FAILURE;
    }

    pOIDObject = (PANSC_ASN1_OIDEN)pNewObject->GetChildByIndex(pNewObject,0);

    if( pOIDObject == NULL)
    {
        return ANSC_STATUS_FAILURE;
    }

    pOIDObject->SetStringOIDValue(pOIDObject, pOIDString);

    pParams = (PANSC_ASN1_PARAMETERS)pNewObject->GetChildByIndex(pNewObject,1);

    pParams->SetSelection
        (
            pParams, 
            PARAMETERS_MASK_NULLPARMS, 
            pParams->CreateSelection(pParams,PARAMETERS_MASK_NULLPARMS)
        );

    return ANSC_STATUS_SUCCESS;
}

/***************************************************************
 *
 * This one is important for generating SignedData.
 *
 * We suggest to call this api after you initiate all other fields.
 *
 * If Add certificate only, the pSignProc can be set as NULL;
 * If signature is required, the last 3 parameters should be inputted,
 * a new signerInfo will be created and added.
 *
 ***************************************************************/
static
ANSC_HANDLE
signedDataGenerateSignerInfo
    (
        ANSC_HANDLE                 hCertificate,
        ANSC_HANDLE                 hSignedHandle,
        CRYPT_SIGNDATA_PROC         pSignProc,     /* proc to sign the data */
        ANSC_HANDLE                 hParameter,    /* the parameter of above proc */
        HASH_TYPE                   hashType
    )
{
    PANSC_ASN1_CERTIFICATE          pCertObject     = (PANSC_ASN1_CERTIFICATE)hCertificate;
    PANSC_ASN1_OBJECT               pSignObject     = (PANSC_ASN1_OBJECT)hSignedHandle;
    UCHAR                           pSignature[512] = { 0 };
    ULONG                           signLength      = 512;
    PANSC_ASN1_SEQUENCE             pSignerInfo;
    PANSC_ASN1_SEQUENCE             pSeqObject;
    PANSC_ASN1_NAME                 pNameDest, pNameSrc;
    PANSC_ASN1_INTEGER              pIntDest, pIntSrc;
    PANSC_ASN1_ALGORITHMIDENTIFIER  pDigestAlg;
    PANSC_ASN1_STRING               pStrObj;
    PUCHAR                          pEncoding       = NULL;
    ULONG                           length;
    SIGNATURE_TYPE                  signType;

    if(hCertificate == NULL || hSignedHandle == NULL || pSignProc == NULL)
    {
        return NULL;
    }

    if( pCertObject->GetKeyType(pCertObject) != PKI_RSA_KEY)
    {
       AnscTrace("Only RSA key is supported in the signature.\n");
       
       return NULL;
    }

    pSignerInfo = (PANSC_ASN1_SEQUENCE)AnscAsn1CreateSignerInfo(NULL);

    if( pSignerInfo == NULL)
    {
        return NULL;
    }

    if( hashType == HASH_MD5)
    {
        signType = RSA_MD5_SIGNATURE;
    }
    else
    {
        signType = RSA_SHA1_SIGNATURE;
    }

    /**********************************************************************

     OBJECT -- ANSC_ASN1_SIGNERINFO

     SignerInfo ::= Sequence 
         {
                               version Integer OPT
                 issuerAndSerialNumber IssuerAndSerialNumber 
                       digestAlgorithm DigestAlgorithmIdentifier 
               authenticatedAttributes [CON 0] IMP Attributes OPT
             digestEncryptionAlgorithm DigestEncryptionAlgorithmIdentifier 
                       encryptedDigest EncryptedDigest 
             unauthenticatedAttributes [CON 1] IMP Attributes OPT
         }

     **********************************************************************/     
     /* set the issuer and name first; */
     pSeqObject = (PANSC_ASN1_SEQUENCE)
         pSignerInfo->GetChildByIndex(pSignerInfo, 1);

     if( pSeqObject == NULL)
     {
         goto EXIT;
     }

     /* the name */
     pNameDest = (PANSC_ASN1_NAME)
         pSeqObject->GetChildByIndex(pSeqObject, 0);

     pNameSrc = (PANSC_ASN1_NAME)
         pCertObject->GetIssuerHandle(pCertObject);

     if( pNameDest == NULL || pNameSrc == NULL)
     {
         goto EXIT;
     }

     pNameSrc->CopyTo(pNameSrc, pNameDest);   

    /* the serial number */
     pIntDest = (PANSC_ASN1_INTEGER)
         pSeqObject->GetChildByIndex(pSeqObject,1);

     pIntSrc = (PANSC_ASN1_INTEGER)
         pCertObject->GetSerialNumber(pCertObject);

     if( pIntSrc == NULL || pIntDest == NULL)
     {
         goto EXIT;
     }
    
     pIntSrc->CopyTo(pIntSrc, pIntDest);

     /* set the digest algorithm */
     pDigestAlg = (PANSC_ASN1_ALGORITHMIDENTIFIER)
         pSignerInfo->GetChildByIndex(pSignerInfo, 2);

     if( pDigestAlg == NULL)
     {
         goto EXIT;
     }

     pDigestAlg->bOptional = FALSE;

    if( hashType == HASH_MD5)
    {
        pDigestAlg->SetAlgorOIDStringValue(pDigestAlg, "1.2.840.113549.2.5");
    }
    else /* sha1 */
    {
        pDigestAlg->SetAlgorOIDStringValue(pDigestAlg, "1.3.14.3.2.26");
    }

     /* set the digestEncryption alg */
     pDigestAlg = (PANSC_ASN1_ALGORITHMIDENTIFIER)
         pSignerInfo->GetChildByIndex(pSignerInfo, 4);

     if( pDigestAlg == NULL)
     {
         goto EXIT;
     }

     /* we always go with RSA encryption */
     pDigestAlg->bOptional = FALSE;

     pDigestAlg->SetAlgorOIDStringValue
         (
            pDigestAlg, 
            "1.2.840.113549.1.1.1"
         );

     /* get the encoding data */
     pEncoding = pSignObject->GetEncodedData(pSignObject, &length);

     if( pEncoding == NULL)
     {
         goto EXIT;
     }

     /* get the signature here */
     if( ANSC_STATUS_SUCCESS !=
            pSignProc
                (
                    hParameter,
                    pEncoding,
                    length,
                    signType,
                    pSignature,
                    &signLength
                )
       ) 
     {
        goto EXIT;
     }

     /* free the encoding data */
     AnscFreeMemory(pEncoding);
     pEncoding = NULL; /*RDKB-6201, CID-32894; avoiding double free*/

    /* copy the signature to the string object */
    pStrObj = (PANSC_ASN1_STRING)
        pSignerInfo->GetChildByIndex(pSignerInfo, 5);

    if( pStrObj == NULL)
    {
        goto EXIT;
    }

    pStrObj->SetStringValue(pStrObj, pSignature, signLength);

    return pSignerInfo;

EXIT:

    if( pSignerInfo != NULL)
    {
        pSignerInfo->AsnFree(pSignerInfo);
    }

    if( pEncoding != NULL)
    {
        AnscFreeMemory(pEncoding);
    }

    return NULL;
}

ANSC_STATUS
AnscAsn1SignedDataAddCertificate
    (
        ANSC_HANDLE                 hThisObject,
        ANSC_HANDLE                 hCertificate,
        CRYPT_SIGNDATA_PROC         pSignProc,     /* proc to sign the data */
        ANSC_HANDLE                 hParameter,    /* the parameter of above proc */
        HASH_TYPE                   hashType
    )
{
    PANSC_ASN1_SIGNEDDATA           pThisObject  = (PANSC_ASN1_SIGNEDDATA)hThisObject;
    ANSC_STATUS                     retStatus    = ANSC_STATUS_SUCCESS;
    PANSC_ASN1_CERTIFICATES         pCerts;
    PANSC_ASN1_SETOF                pSignerInfos;
    PANSC_ASN1_OBJECT               pSignerInfo;
    PANSC_ASN1_OBJECT               pSignedHandle;
    ULONG                           count;

    if( pThisObject == NULL || hCertificate == NULL)
    {
        return ANSC_STATUS_FAILURE;
    }

    pCerts = (PANSC_ASN1_CERTIFICATES)pThisObject->GetChildByIndex(pThisObject,3);

    if( pCerts == NULL)
    {
        return ANSC_STATUS_FAILURE;
    }

    pCerts->bOptional = FALSE;

    retStatus = pCerts->AddChild(pCerts, hCertificate);

    if( ANSC_STATUS_SUCCESS != retStatus)
    {
        return retStatus;
    }

    if( pSignProc == NULL )
    {
        return retStatus;
    }

    /* try to generate the signature with the given certificate */
    if( hashType == HASH_RESERVE)
    {
        return ANSC_ASN1_NOT_SUPPORTED;
    }

    if( hashType == HASH_MD5)
    {
        retStatus = 
            pThisObject->AddDigestAlgor(pThisObject, "1.2.840.113549.2.5");
    }
    else /* sha1 */
    {
        retStatus = 
            pThisObject->AddDigestAlgor(pThisObject, "1.3.14.3.2.26");
    }

    if( ANSC_STATUS_SUCCESS != retStatus)
    {
        return retStatus;
    }

    /* get the signed handle, if it's unavaliable, don't need digest */
    pSignedHandle = (PANSC_ASN1_OBJECT)pThisObject->GetSignedHandle(pThisObject);

    if( pSignedHandle == NULL)
    {
        return retStatus;
    }

    /* check the certificate, if not cert available, we don't need digest also; */
    count = pThisObject->GetTotalCerts(pThisObject);

    if( count == 0)
    {
        return retStatus;
    }

    /* get the signerinfos object */
    pSignerInfos = (PANSC_ASN1_SETOF)pThisObject->GetChildByIndex(pThisObject,5);
    
    if( pSignerInfos == NULL)
    {
        return ANSC_STATUS_FAILURE;
    }

    pSignerInfo = (PANSC_ASN1_OBJECT)
        signedDataGenerateSignerInfo
            (
                hCertificate,
                pSignedHandle,
                pSignProc,     /* proc to sign the data */
                hParameter,    /* the parameter of above proc */
                hashType
            );

    if( pSignerInfo == NULL)
    {
        return ANSC_STATUS_FAILURE;
    }

    retStatus = pSignerInfos->AddChild(pSignerInfos, pSignerInfo);

    if( ANSC_STATUS_SUCCESS != retStatus)
    {
        pSignerInfo->AsnFree(pSignerInfo);        
    }

    return retStatus;
}

ANSC_HANDLE
AnscAsn1SignedDataGetCertificateByIndex
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       ulIndex
    )
{
    PANSC_ASN1_SIGNEDDATA           pThisObject  = (PANSC_ASN1_SIGNEDDATA)hThisObject;
    PANSC_ASN1_CERTIFICATES         pCerts;
    ULONG                           count;

    if( pThisObject == NULL )
    {
        return NULL;
    }

    pCerts = (PANSC_ASN1_CERTIFICATES)pThisObject->GetChildByIndex(pThisObject,3);

    if( pCerts == NULL || pCerts->bOptional)
    {
        return NULL;
    }

    count  = pCerts->GetChildCount(pCerts);

    if( count <= ulIndex)
    {
        return NULL;
    }

    return pCerts->GetChildByIndex(pCerts, ulIndex);
}

ULONG
AnscAsn1SignedDataGetTotalCerts
    (
        ANSC_HANDLE                 hThisObject
    )
{
    PANSC_ASN1_SIGNEDDATA           pThisObject  = (PANSC_ASN1_SIGNEDDATA)hThisObject;
    PANSC_ASN1_CERTIFICATES         pCerts;

    if( pThisObject == NULL )
    {
        return 0;
    }

    pCerts = (PANSC_ASN1_CERTIFICATES)pThisObject->GetChildByIndex(pThisObject,3);

    if( pCerts == NULL || pCerts->bOptional)
    {
        return 0;
    }

    return pCerts->GetChildCount(pCerts);
}

ANSC_HANDLE
AnscAsn1SignedDataGetSignedHandle
    (
        ANSC_HANDLE                 hThisObject
    )
{
    PANSC_ASN1_SIGNEDDATA           pThisObject  = (PANSC_ASN1_SIGNEDDATA)hThisObject;
    PANSC_ASN1_CONTENTINFO          pContentInfo;
 
    if( pThisObject == NULL )
    {
        return NULL;
    }

    pContentInfo = (PANSC_ASN1_CONTENTINFO)pThisObject->GetChildByIndex(pThisObject,2);

    if( pContentInfo == NULL || pContentInfo->bOptional)
    {
        return NULL;
    }

    return pContentInfo->GetExtraChild(pContentInfo);
}

ANSC_STATUS
AnscAsn1SignedDataSetSignedHandle
    (
        ANSC_HANDLE                 hThisObject,
        ANSC_HANDLE                 hSignHandle
    )
{
    PANSC_ASN1_SIGNEDDATA           pThisObject  = (PANSC_ASN1_SIGNEDDATA)hThisObject;
    PANSC_ASN1_CONTENTINFO          pContentInfo;
 
    if( pThisObject == NULL || hSignHandle == NULL)
    {
        return ANSC_STATUS_FAILURE;
    }

    pContentInfo = (PANSC_ASN1_CONTENTINFO)pThisObject->GetChildByIndex(pThisObject,2);

    if( pContentInfo == NULL || pContentInfo->bOptional)
    {
        return ANSC_STATUS_FAILURE;
    }

    return pContentInfo->SetExtraChild(pContentInfo, hSignHandle, TRUE);
}


ANSC_HANDLE
AnscAsn1SignedDataLookinForIssuer
    (
        ANSC_HANDLE                 hThisObject,
        ANSC_HANDLE                 hCert
    )
{
    PANSC_ASN1_SIGNEDDATA           pThisObject  = (PANSC_ASN1_SIGNEDDATA)hThisObject;
    PANSC_ASN1_CERTIFICATE          pCert        = (PANSC_ASN1_CERTIFICATE)hCert;
    PANSC_ASN1_CERTIFICATE          pLooking;
    ULONG                           i,count;

    if( pThisObject == NULL || pCert == NULL)
    {
        return NULL;
    }

    /* if it's selfsigned, return itself */
    if( pCert->IsSelfSigned(pCert))
    {
        return hCert;
    }

    /* check others in the SignedData */
    count = pThisObject->GetTotalCerts(pThisObject);

    if( count == 0)
    {
        return NULL;
    }

    for( i = 0;  i < count; i ++)
    {
        pLooking = (PANSC_ASN1_CERTIFICATE)
            pThisObject->GetCertificateByIndex(pThisObject, i);

        if( pLooking != NULL && pLooking != pCert)
        {
            if( pCert->IsThisTheIssuer(pCert, pLooking))
            {
                return pLooking;
            }
        }
    }

    return NULL;
}

/*
 *  Verify the certificate chain.
 *
 *  It's optional for the verifier to provide the hCACert to
 *  verify the certificate chain.
 *
 *  If failed to find the issuer or verify the signature of certain
 *  cert in the chain, returns the error and put the cert index in
 *  the buffer of pUlQuestionIndex.
 */

ANSC_STATUS
AnscAsn1SignedDataVerifyCertChain
    (
        ANSC_HANDLE                 hThisObject,
        ANSC_HANDLE                 hCACert,
        PULONG                      pUlQuestionIndex,
        BOOLEAN                     bCheckTime
    )
{
    PANSC_ASN1_SIGNEDDATA           pThisObject  = (PANSC_ASN1_SIGNEDDATA)hThisObject;
    PANSC_ASN1_CERTIFICATE          pRootCA      = (PANSC_ASN1_CERTIFICATE)hCACert;
    PANSC_ASN1_CERTIFICATE          pCertObject, pIssuer;
    ULONG                           i,count;
    ANSC_STATUS                     retStatus;

    if( hThisObject == NULL)
    {
        return ANSC_STATUS_FAILURE;
    }

    count = pThisObject->GetTotalCerts(pThisObject);

    if( count == 0)
    {
        return ANSC_STATUS_SUCCESS;
    }

    /* verify the certificate one by one */
    for( i = 0; i < count; i ++)
    {
        pCertObject = (PANSC_ASN1_CERTIFICATE)
            pThisObject->GetCertificateByIndex(pThisObject, i);

        if( pCertObject == NULL)
        {
            if( pUlQuestionIndex  != NULL)
            {
                *pUlQuestionIndex = i;
            }

            return ANSC_STATUS_FAILURE;
        }

        /* check the cert valid or not */
        retStatus = pCertObject->CheckValidity(pCertObject, bCheckTime);

        if(  retStatus != ANSC_STATUS_SUCCESS)
        {
           return retStatus;
        }


        /* find the issuer cert and verify it */
        pIssuer = 
            pThisObject->LookingForIssuer
                (
                    pThisObject, 
                    pCertObject
                );
        
        if( pIssuer == NULL)
        {
            /* if no root ca, maybe provide in the parameter */
            pIssuer = pRootCA;
        }

        if( pIssuer == NULL)
        {
            if( pUlQuestionIndex  != NULL)
            {
                *pUlQuestionIndex = i;
            }
            
            return ANSC_ASN1_ERROR_FIND_ISSUER;
        }

        /* try to verify it */
        retStatus = 
            pIssuer->VerifyChildCert( pIssuer,pCertObject);

        if( retStatus != ANSC_STATUS_SUCCESS)
        {
            if( pUlQuestionIndex  != NULL)
            {
                *pUlQuestionIndex = i;
            }
            
            return ANSC_ASN1_FAILED_TO_VERIFY;
        }
    }

    return ANSC_STATUS_SUCCESS;
}

/*
 *  Verify the Digest in the signerInfos
 *
 *  If failed to verify the digest of certain
 *  cert in the chain, returns the error and put the cert index in
 *  the buffer of pUlQuestionIndex.
 */
static
ANSC_HANDLE
lookingforCertificate
    (
        ANSC_HANDLE                     hThisObject, /* SignedData */
        ANSC_HANDLE                     hSignerInfo
    )
{
    PANSC_ASN1_SEQUENCE                 pSignerInfo  = (PANSC_ASN1_SEQUENCE)hSignerInfo;
    PANSC_ASN1_SIGNEDDATA               pThisObject  = (PANSC_ASN1_SIGNEDDATA)hThisObject;
    PANSC_ASN1_CERTIFICATE              pCertificate = NULL;
    PANSC_ASN1_SEQUENCE                 pIssuerAndSerial;
    ULONG                               i,  count;
    PANSC_ASN1_INTEGER                  pIntObj1, pIntObj2;
    PANSC_ASN1_NAME                     pNameObj1, pNameObj2;

    if( hThisObject == NULL || hSignerInfo == NULL)
    {
        return NULL;
    }

    pIssuerAndSerial = (PANSC_ASN1_SEQUENCE)
        pSignerInfo->GetChildByIndex(pSignerInfo, 1);

    if( pIssuerAndSerial == NULL)
    {
        return NULL;
    }

    pNameObj1 = (PANSC_ASN1_NAME)pIssuerAndSerial->GetChildByIndex(pIssuerAndSerial,0);
    pIntObj1 = (PANSC_ASN1_INTEGER)pIssuerAndSerial->GetChildByIndex(pIssuerAndSerial, 1);

    if( pNameObj1 == NULL || pIntObj1 == NULL)
    {
        return NULL;
    }

    count = pThisObject->GetTotalCerts(pThisObject);

    for( i = 0; i < count; i ++)
    {
        pCertificate = (PANSC_ASN1_CERTIFICATE)
            pThisObject->GetCertificateByIndex(pThisObject, i);

        if( pCertificate != NULL)
        {
            /* check the issuer name and serial number */
            pIntObj2 = (PANSC_ASN1_INTEGER)pCertificate->GetSerialNumber(pCertificate);

            if(!pIntObj1->EqualsTo(pIntObj1, pIntObj2, TRUE))
            {
                continue;
            }
            
            pNameObj2 = (PANSC_ASN1_NAME)pCertificate->GetIssuerHandle(pCertificate);

            if( !pNameObj1->EqualsTo(pNameObj1, pNameObj2, TRUE))
            {
                continue;
            }

            return pCertificate;
        }
    }

    return NULL;
}

static
BOOLEAN
verifyMessageDigest
    (
        ANSC_HANDLE                     hSignerInfo,
        PUCHAR                          pEncoding,
        ULONG                           length,
        HASH_TYPE                       hashType
    )
{
    PANSC_ASN1_SEQUENCE                 pSignerInfo = (PANSC_ASN1_SEQUENCE)hSignerInfo;
    PANSC_ASN1_SETOF                    pAuthAttr = NULL;
    PANSC_ASN1_ATTRIBUTE                pAttribute = NULL;
    PANSC_ASN1_OIDEN                    pOIDObj = NULL;
    PANSC_ASN1_SETOF                    pAttrValues = NULL;
    PANSC_ASN1_CHOICE                   pAttrValue = NULL;
    PANSC_ASN1_OBJECT                   pTmpObj = NULL;
    PANSC_ASN1_STRING                   pStrObj = NULL; /*RDKB-6201, CID-24783, initialize before use*/
    CHAR                                pOIDString[128] = { 0 };
    ULONG                               i = 0;
    ANSC_CRYPTO_HASH                    hashResult = {0};
    PANSC_CRYPTO_OBJECT                 pCrypto     = NULL;
    ULONG                               ulHashSize = 0;

    if( hSignerInfo == NULL)
    {
        return FALSE;
    }

    /**********************************************************************

     OBJECT -- ANSC_ASN1_SIGNERINFO

     SignerInfo ::= Sequence 
         {
                               version Integer OPT
                 issuerAndSerialNumber IssuerAndSerialNumber 
                       digestAlgorithm DigestAlgorithmIdentifier 
               authenticatedAttributes [CON 0] IMP Attributes OPT
             digestEncryptionAlgorithm DigestEncryptionAlgorithmIdentifier 
                       encryptedDigest EncryptedDigest 
             unauthenticatedAttributes [CON 1] IMP Attributes OPT
         }
     **********************************************************************/     
     /* Find the attribute with messagedigest first */
     pAuthAttr = (PANSC_ASN1_SETOF)
         pSignerInfo->GetChildByIndex(pSignerInfo, 3);

     for( i = 0; i < pAuthAttr->GetChildCount(pAuthAttr); i ++)
     {
        pAttribute = (PANSC_ASN1_ATTRIBUTE)
            pAuthAttr->GetChildByIndex(pAuthAttr, i);

        pOIDObj =  (PANSC_ASN1_OIDEN)
            pAttribute->GetChildByIndex(pAttribute, 0);

        pOIDObj->GetStringOIDValue(pOIDObj, pOIDString);

        /* find PKCS9MessageDigest */
        if( strcasecmp( pOIDString, "1.2.840.113549.1.9.4") == 0 )
        {
            pAttrValues = (PANSC_ASN1_SETOF)
                pAttribute->GetChildByIndex(pAttribute, 1);
            
            pAttrValue = (PANSC_ASN1_CHOICE)
                pAttrValues->GetChildByIndex(pAttrValues,0);

            if( pAttrValue == NULL)
            {
                return FALSE;
            }

            pTmpObj = (PANSC_ASN1_OBJECT)pAttrValue->GetSelection(pAttrValue);

            while( pTmpObj != NULL && IsObjectChoiceType(pTmpObj->uType))
            {
                pTmpObj = (PANSC_ASN1_OBJECT)
                    ((PANSC_ASN1_CHOICE)pTmpObj)->GetSelection(pTmpObj);
            }

            pStrObj = (PANSC_ASN1_STRING)pTmpObj;

            break;
        }
     }

    if( pStrObj == NULL)
    {
        return FALSE;
    }

    /* create the crypto */
    pCrypto = (PANSC_CRYPTO_OBJECT)AnscCreateCrypto(NULL);

    if (pCrypto == NULL)
    {
        return FALSE;
    }

    /* verify the message digest */    
    if( hashType == HASH_MD5)
    {
        hashResult.Length = ANSC_MD5_OUTPUT_SIZE;

        ulHashSize  = pCrypto->Md5Digest(pEncoding, length, &hashResult);

        hashResult.Length = ulHashSize;
    }
    else
    {
        hashResult.Length = ANSC_SHA1_OUTPUT_SIZE;

        ulHashSize  = pCrypto->Sha1Digest(pEncoding, length, &hashResult);

        hashResult.Length = ulHashSize;
    }

    /* remove the crypto */
    pCrypto->Remove(pCrypto);

    if( hashResult.Length != pStrObj->uLength)
    {
        AnscTrace
            (
                "The length of MD not matched, '%lu' is expected, but it's '%lu'\n",
                pStrObj->uLength,
                hashResult.Length
            );

        return FALSE;
    }

    if( !AnscEqualMemory( pStrObj->GetValueBuffer(pStrObj), hashResult.Value, hashResult.Length))
    {
        AnscTrace("The MessageDigest doesn't matche.\n");

        return FALSE;
    }

    return TRUE;
}

static
BOOLEAN
verifySignerInfo
    (
        PUCHAR                          pEncoding,
        ULONG                           length,
        ANSC_HANDLE                     hCert,
        ANSC_HANDLE                     hSignerInfo
    )
{
    PANSC_ASN1_CERTIFICATE              pCert       = (PANSC_ASN1_CERTIFICATE)hCert;
    PANSC_ASN1_SEQUENCE                 pSignerInfo = (PANSC_ASN1_SEQUENCE)hSignerInfo;
    PANSC_ASN1_ALGORITHMIDENTIFIER      pDigestAlg;
    PANSC_ASN1_STRING                   pStrObj;
    SIGNATURE_TYPE                      signType;
    HASH_TYPE                           hashType;
    PANSC_ASN1_OBJECT                   pAuthAttr;
    PUCHAR                              pMyEncoding;
    ULONG                               newLength;
    CHAR                                pOIDString[128] = { 0 };
    PANSC_ASN1_SUBJECTPUBLICKEYINFO     pPublicKeyInfo;

    if( pEncoding == NULL || hCert == NULL || hSignerInfo == NULL || length < 4)
    {
        return FALSE;
    }

    /**********************************************************************

     OBJECT -- ANSC_ASN1_SIGNERINFO

     SignerInfo ::= Sequence 
         {
                               version Integer OPT
                 issuerAndSerialNumber IssuerAndSerialNumber 
                       digestAlgorithm DigestAlgorithmIdentifier 
               authenticatedAttributes [CON 0] IMP Attributes OPT
             digestEncryptionAlgorithm DigestEncryptionAlgorithmIdentifier 
                       encryptedDigest EncryptedDigest 
             unauthenticatedAttributes [CON 1] IMP Attributes OPT
         }
     **********************************************************************/     

     /* get the hash algorithm */
    pDigestAlg = (PANSC_ASN1_ALGORITHMIDENTIFIER)
        pSignerInfo->GetChildByIndex(pSignerInfo, 2);

    pDigestAlg->GetAlgorOIDStringValue(pDigestAlg, pOIDString);

    if( strcasecmp(pOIDString, "1.3.14.3.2.26") == 0 )
    {
        hashType = HASH_SHA1;
        signType = RSA_SHA1_SIGNATURE;
    }
    else if( strcasecmp(pOIDString, "1.2.840.113549.2.5") == 0 )
    {   
        hashType = HASH_MD5;
        signType = RSA_MD5_SIGNATURE;
    }
    else
    {
        AnscTrace("Unsupported digest algor here: %s\n", pOIDString);

        return FALSE;
    }

    /* get publickeyinfo from the certificate */
    pPublicKeyInfo = (PANSC_ASN1_SUBJECTPUBLICKEYINFO)
        pCert->GetPublicKeyInfo(pCert);

    if( pPublicKeyInfo == NULL)
    {
        AnscTrace("Failed to get the publickeyInfo  from the ceriticate. \n");
        return FALSE;
    }

    /* get the signature from the digest */
    pStrObj = (PANSC_ASN1_STRING)
        pSignerInfo->GetChildByIndex(pSignerInfo, 5);

    if( pStrObj == NULL)
    {
        return FALSE;
    }

     /*
      *  We need to separate the verification here:
      *
      *  A. If AuthAttr is optional, we need to verify the signature of the signed handle;
      *  B. Otherwise, verify the message digest in the AuthAttr first, and then verify the 
      *     signature of AuthAttr;
      */
    pAuthAttr = (PANSC_ASN1_OBJECT)
        pSignerInfo->GetChildByIndex(pSignerInfo, 3);

    if( pAuthAttr == NULL || pAuthAttr->bOptional)
    {
        /* verify the signature  of the signedHandle */
        if( ANSC_STATUS_SUCCESS != 
                pPublicKeyInfo->Verify
                    (
                        pPublicKeyInfo,
                        pEncoding,
                        length,
                        signType,
                        pStrObj->GetValueBuffer(pStrObj),
                        pStrObj->uLength                        
                    )
          )
        {
            return FALSE;
        }

        return TRUE;
    }
    else
    {
        /* verify the digest first */
        if(!verifyMessageDigest
                (
                    hSignerInfo,
                    pEncoding,
                    length,
                    hashType
                ))
        {
            AnscTrace("The message digest in SignerInfo is incorrect.\n"); 

            return FALSE;
        }

        pMyEncoding = pAuthAttr->GetEncodedData(pAuthAttr, &newLength);

        if( pMyEncoding == NULL)
        {
            return FALSE;
        }

        /**************************************************************
         *
         * Please read PKCS7 document, here we need to change the first
         * byte from "A0" to "31" ( from "[0]" to "SETOF") 
         *
         ************************************************************/
        pMyEncoding[0] = 0x31;

        /* verify the signature */
        if( ANSC_STATUS_SUCCESS != 
                pPublicKeyInfo->Verify
                    (
                        pPublicKeyInfo,
                        pMyEncoding,
                        newLength,
                        signType,
                        pStrObj->GetValueBuffer(pStrObj),
                        pStrObj->uLength                        
                    )
          )
        {
            AnscFreeMemory(pMyEncoding);

            return FALSE;
        }

        AnscFreeMemory(pMyEncoding);

        return TRUE;
    }
}

ANSC_STATUS
AnscAsn1SignedDataVerifyMessageDigest
    (
        ANSC_HANDLE                 hThisObject,
        PULONG                      pUlQuestionIndex
    )
{
    PANSC_ASN1_SIGNEDDATA           pThisObject  = (PANSC_ASN1_SIGNEDDATA)hThisObject;
    PANSC_ASN1_CERTIFICATE          pCertificate;
    PANSC_ASN1_SEQUENCE             pSignerInfo;
    PANSC_ASN1_SETOF                pSignerInfos;
    PUCHAR                          pEncoding   =  NULL;
    ULONG                           length;
    ULONG                           i;
    ANSC_STATUS                     retStatus   =  ANSC_STATUS_SUCCESS;
    PANSC_ASN1_CONTENTINFO          pContentInfo;
    PANSC_ASN1_OBJECT               pObject;
    PANSC_ASN1_STRING               pStrObj;

    if( hThisObject == NULL)
    {
        return ANSC_STATUS_FAILURE;
    }

    /* check the data, if it's optional, return success */
    pContentInfo = (PANSC_ASN1_CONTENTINFO)pThisObject->GetChildByIndex(pThisObject,2);

    if( pContentInfo == NULL || pContentInfo->bOptional)
    {
        return ANSC_STATUS_SUCCESS;
    }

    pObject = (PANSC_ASN1_OBJECT)pContentInfo->GetChildByIndex(pContentInfo, 1);

    if( pObject != NULL && pObject->bOptional)
    {
        return ANSC_STATUS_SUCCESS;
    }

    /* get the data of the content */
     /*CID: 56448 Dereference after null check*/
    while( pObject && IsObjectChoiceType(pObject->uType))
    {
        pObject = (PANSC_ASN1_OBJECT)
            ((PANSC_ASN1_CHOICE)pObject)->hSelection;

        if( pObject == NULL)
        {
            return ANSC_STATUS_FAILURE;
        }
    }

    pStrObj = (PANSC_ASN1_STRING)pObject;

    if( pStrObj->GetStringValue(pStrObj, (PUCHAR*)&pEncoding, &length) != ANSC_STATUS_SUCCESS ||
        pEncoding == NULL || length == 0)
    {
        return ANSC_STATUS_FAILURE;
    }

    /* get the signerInfos */
    pSignerInfos = (PANSC_ASN1_SETOF)pThisObject->GetChildByIndex(pThisObject,5);
    
    if( pSignerInfos == NULL || pSignerInfos->bOptional 
        || pSignerInfos->GetChildCount(pSignerInfos) == 0)
    {
        return ANSC_STATUS_SUCCESS;
    }

    /* verify it one by one */
    for( i = 0; i < pSignerInfos->GetChildCount(pSignerInfos); i ++)
    {
        pSignerInfo = (PANSC_ASN1_SEQUENCE)
            pSignerInfos->GetChildByIndex(pSignerInfos, i);

        pCertificate = (PANSC_ASN1_CERTIFICATE)
            lookingforCertificate
                (
                    pThisObject,
                    pSignerInfo
                );

        if( pCertificate == NULL)
        {
            AnscTrace("Failed to find the cerificate for SignerInfo '%lu'\n", i);

            if( pUlQuestionIndex != NULL)
            {
                *pUlQuestionIndex = i;
            }

            retStatus = ANSC_ASN1_ERROR_FIND_ISSUER;

            goto EXIT;
        }

        if(!verifySignerInfo( pEncoding, length, pCertificate, pSignerInfo))
        {
            AnscTrace("Failed to verify SignerInfo '%lu'\n", i);

            if( pUlQuestionIndex != NULL)
            {
                *pUlQuestionIndex = i;
            }

            retStatus = ANSC_ASN1_FAILED_TO_VERIFY;

            goto EXIT;
        }
    }

EXIT:

    if( pEncoding != NULL)
    {
        AnscFreeMemory(pEncoding);
    }

    return retStatus;
}

ANSC_HANDLE
AnscAsn1SignedDataGetFirstCertOfTheChain
    (
        ANSC_HANDLE                 hThisObject
    )
{
    PANSC_ASN1_SIGNEDDATA           pThisObject  = (PANSC_ASN1_SIGNEDDATA)hThisObject;
    PANSC_ASN1_CERTIFICATES         pCerts;
    PANSC_ASN1_CERTIFICATE          pCert;
    ULONG                           count;
    ULONG                           i;

    if( pThisObject == NULL )
    {
        return NULL;
    }

    pCerts = (PANSC_ASN1_CERTIFICATES)pThisObject->GetChildByIndex(pThisObject,3);

    if( pCerts == NULL || pCerts->bOptional)
    {
        return NULL;
    }

    count  = pCerts->GetChildCount(pCerts);

    if( count == 0)
    {
        return NULL;
    }

    if( count == 1)
    {
        return pCerts->GetChildByIndex(pCerts,0);
    }

    for( i = 0; i < count; i ++)
    {
        pCert = (PANSC_ASN1_CERTIFICATE)
            pCerts->GetChildByIndex(pCerts, i);

        if( pCert == NULL)
        {
            return NULL;
        }

        if( pCert->IsSelfSigned(pCert))
        {
            return pCert;
        }

        if(pThisObject->LookingForIssuer
                (
                    pThisObject,
                    pCert
                ) == NULL)
        {
            return pCert;
        }
    }

    return NULL;
}

ANSC_HANDLE
AnscAsn1SignedDataGetLastCertOfTheChain
    (
        ANSC_HANDLE                 hThisObject
    )
{
    PANSC_ASN1_SIGNEDDATA           pThisObject  = (PANSC_ASN1_SIGNEDDATA)hThisObject;
    PANSC_ASN1_CERTIFICATES         pCerts;
    PANSC_ASN1_CERTIFICATE          pCert, pLooking;
    ULONG                           count;

    if( pThisObject == NULL )
    {
        return NULL;
    }

    pCerts = (PANSC_ASN1_CERTIFICATES)pThisObject->GetChildByIndex(pThisObject,3);

    if( pCerts == NULL || pCerts->bOptional)
    {
        return NULL;
    }

    count  = pCerts->GetChildCount(pCerts);

    if( count == 0)
    {
        return NULL;
    }

    if( count == 1)
    {
        return pCerts->GetChildByIndex(pCerts,0);
    }

    pLooking = (PANSC_ASN1_CERTIFICATE)
        pThisObject->GetFirstCertOfTheChain(pThisObject);

    pCert = (PANSC_ASN1_CERTIFICATE)
        pCerts->GetChildByIndex(pCerts, 0);

    if( pLooking != pCert)
    {
        return pCert;
    }

    return (PANSC_ASN1_CERTIFICATE)
        pCerts->GetChildByIndex(pCerts, count - 1);
}

/**********************************************************************

 OBJECT -- ANSC_ASN1_DIGESTALGORITHMIDENTIFIERS

 DigestAlgorithmIdentifiers ::= SetOf DigestAlgorithmIdentifier  {}

 **********************************************************************/

ANSC_HANDLE 
AnscAsn1CreateDigestAlgorithmIdentifiers
    (
        ANSC_HANDLE                 hReserved
    )
{
    PANSC_ASN1_DIGESTALGORITHMIDENTIFIERS 
                                    pThisObject  = NULL;

    /*
     * Create the base ASN.1 object.
     */
    pThisObject = (PANSC_ASN1_DIGESTALGORITHMIDENTIFIERS)
        AnscAsn1CreateSetOf
            (
                hReserved
            );

    if( pThisObject == NULL)
    {
        return (ANSC_HANDLE)NULL;
    }

    /*
     * Initialize the common variables and functions for this ASN.1 object.
     */
    pThisObject->SetClassName(pThisObject, "ANSC_ASN1_DIGESTALGORITHMIDENTIFIERS");
    pThisObject->SetName(pThisObject, "DigestAlgorithmIdentifiers");

    pThisObject->Create             = AnscAsn1CreateDigestAlgorithmIdentifiers;
    pThisObject->CreateChild        = AnscAsn1DigestAlgorithmIdentifiersCreateChild;
    pThisObject->IsChildValid       = AnscAsn1DigestAlgorithmIdentifiersIsChildValid;

    return (ANSC_HANDLE)pThisObject;
}

ANSC_HANDLE
AnscAsn1DigestAlgorithmIdentifiersCreateChild
    (
        ANSC_HANDLE                 hThisObject,
        BOOLEAN                     bAddItIn
    )
{
    PANSC_ASN1_SETOF                pParentObj   = (PANSC_ASN1_SETOF)hThisObject;
    PANSC_ASN1_OBJECT               pThisObject  = NULL;

    pThisObject  = AnscAsn1CreateDigestAlgorithmIdentifier(NULL);

    if( pThisObject != NULL && bAddItIn)
    {
        pParentObj->AddChild(pParentObj,pThisObject);
    }

    return pThisObject;
}

ANSC_STATUS
AnscAsn1DigestAlgorithmIdentifiersIsChildValid
    (
        ANSC_HANDLE                 hThisObject,
        ANSC_HANDLE                 hChild
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    PANSC_ASN1_OBJECT               pChild    = (PANSC_ASN1_OBJECT)hChild;

    if( pChild == NULL)
    {
        return ANSC_ASN1_NULL_OBJCET;
    }

    if( !AnscEqualString1(pChild->ClassName, "ANSC_ASN1_DIGESTALGORITHMIDENTIFIER", TRUE))
    {
        return ANSC_ASN1_INVALID_TYPE_IN_SEQOF_OR_SETOF;
    }

    return ANSC_STATUS_SUCCESS;
}

/**********************************************************************

 OBJECT -- ANSC_ASN1_CERTIFICATES

 Certificates ::= SetOf Certificate  {}

 **********************************************************************/

ANSC_HANDLE 
AnscAsn1CreateCertificates
    (
        ANSC_HANDLE                 hReserved
    )
{
    PANSC_ASN1_CERTIFICATES         pThisObject  = NULL;

    /*
     * Create the base ASN.1 object.
     */
    pThisObject = (PANSC_ASN1_CERTIFICATES)
        AnscAsn1CreateSetOf
            (
                hReserved
            );

    if( pThisObject == NULL)
    {
        return (ANSC_HANDLE)NULL;
    }

    /*
     * Initialize the common variables and functions for this ASN.1 object.
     */
    pThisObject->SetClassName(pThisObject, "ANSC_ASN1_CERTIFICATES");
    pThisObject->SetName(pThisObject, "Certificates");

    pThisObject->Create             = AnscAsn1CreateCertificates;
    pThisObject->CreateChild        = AnscAsn1CertificatesCreateChild;
    pThisObject->IsChildValid       = AnscAsn1CertificatesIsChildValid;

    return (ANSC_HANDLE)pThisObject;
}

ANSC_HANDLE
AnscAsn1CertificatesCreateChild
    (
        ANSC_HANDLE                 hThisObject,
        BOOLEAN                     bAddItIn
    )
{
    PANSC_ASN1_SETOF                pParentObj   = (PANSC_ASN1_SETOF)hThisObject;
    PANSC_ASN1_OBJECT               pThisObject  = NULL;

    pThisObject  = AnscAsn1CreateCertificate(NULL);

    if( pThisObject != NULL && bAddItIn)
    {
        pParentObj->AddChild(pParentObj,pThisObject);
    }

    return pThisObject;
}

ANSC_STATUS
AnscAsn1CertificatesIsChildValid
    (
        ANSC_HANDLE                 hThisObject,
        ANSC_HANDLE                 hChild
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    PANSC_ASN1_OBJECT               pChild    = (PANSC_ASN1_OBJECT)hChild;

    if( pChild == NULL)
    {
        return ANSC_ASN1_NULL_OBJCET;
    }

    if( !AnscEqualString1(pChild->ClassName, "ANSC_ASN1_CERTIFICATE", TRUE))
    {
        return ANSC_ASN1_INVALID_TYPE_IN_SEQOF_OR_SETOF;
    }

    return ANSC_STATUS_SUCCESS;
}

/**********************************************************************

 OBJECT -- ANSC_ASN1_CERTIFICATEREVOCATIONLISTS

 CertificateRevocationLists ::= SetOf CRL  {}

 **********************************************************************/

ANSC_HANDLE 
AnscAsn1CreateCertificateRevocationLists
    (
        ANSC_HANDLE                 hReserved
    )
{
    PANSC_ASN1_CERTIFICATEREVOCATIONLISTS 
                                    pThisObject  = NULL;

    /*
     * Create the base ASN.1 object.
     */
    pThisObject = (PANSC_ASN1_CERTIFICATEREVOCATIONLISTS)
        AnscAsn1CreateSetOf
            (
                hReserved
            );

    if( pThisObject == NULL)
    {
        return (ANSC_HANDLE)NULL;
    }

    /*
     * Initialize the common variables and functions for this ASN.1 object.
     */
    pThisObject->SetClassName(pThisObject, "ANSC_ASN1_CERTIFICATEREVOCATIONLISTS");
    pThisObject->SetName(pThisObject, "CertificateRevocationLists");

    pThisObject->Create             = AnscAsn1CreateCertificateRevocationLists;
    pThisObject->CreateChild        = AnscAsn1CertificateRevocationListsCreateChild;
    pThisObject->IsChildValid       = AnscAsn1CertificateRevocationListsIsChildValid;

    return (ANSC_HANDLE)pThisObject;
}

ANSC_HANDLE
AnscAsn1CertificateRevocationListsCreateChild
    (
        ANSC_HANDLE                 hThisObject,
        BOOLEAN                     bAddItIn
    )
{
    PANSC_ASN1_SETOF                pParentObj   = (PANSC_ASN1_SETOF)hThisObject;
    PANSC_ASN1_OBJECT               pThisObject  = NULL;

    pThisObject  = AnscAsn1CreateCRL(NULL);

    if( pThisObject != NULL && bAddItIn)
    {
        pParentObj->AddChild(pParentObj,pThisObject);
    }

    return pThisObject;
}

ANSC_STATUS
AnscAsn1CertificateRevocationListsIsChildValid
    (
        ANSC_HANDLE                 hThisObject,
        ANSC_HANDLE                 hChild
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    PANSC_ASN1_OBJECT               pChild    = (PANSC_ASN1_OBJECT)hChild;

    if( pChild == NULL)
    {
        return ANSC_ASN1_NULL_OBJCET;
    }

    if( !AnscEqualString1(pChild->ClassName, "ANSC_ASN1_CRL", TRUE))
    {
        return ANSC_ASN1_INVALID_TYPE_IN_SEQOF_OR_SETOF;
    }

    return ANSC_STATUS_SUCCESS;
}

/**********************************************************************

 OBJECT -- ANSC_ASN1_SIGNERINFOS

 SignerInfos ::= SetOf SignerInfo  {}

 **********************************************************************/

ANSC_HANDLE 
AnscAsn1CreateSignerInfos
    (
        ANSC_HANDLE                 hReserved
    )
{
    PANSC_ASN1_SIGNERINFOS          pThisObject  = NULL;

    /*
     * Create the base ASN.1 object.
     */
    pThisObject = (PANSC_ASN1_SIGNERINFOS)
        AnscAsn1CreateSetOf
            (
                hReserved
            );

    if( pThisObject == NULL)
    {
        return (ANSC_HANDLE)NULL;
    }

    /*
     * Initialize the common variables and functions for this ASN.1 object.
     */
    pThisObject->SetClassName(pThisObject, "ANSC_ASN1_SIGNERINFOS");
    pThisObject->SetName(pThisObject, "SignerInfos");

    pThisObject->Create             = AnscAsn1CreateSignerInfos;
    pThisObject->CreateChild        = AnscAsn1SignerInfosCreateChild;
    pThisObject->IsChildValid       = AnscAsn1SignerInfosIsChildValid;

    return (ANSC_HANDLE)pThisObject;
}

ANSC_HANDLE
AnscAsn1SignerInfosCreateChild
    (
        ANSC_HANDLE                 hThisObject,
        BOOLEAN                     bAddItIn
    )
{
    PANSC_ASN1_SETOF                pParentObj   = (PANSC_ASN1_SETOF)hThisObject;
    PANSC_ASN1_OBJECT               pThisObject  = NULL;

    pThisObject  = AnscAsn1CreateSignerInfo(NULL);

    if( pThisObject != NULL && bAddItIn)
    {
        pParentObj->AddChild(pParentObj,pThisObject);
    }

    return pThisObject;
}

ANSC_STATUS
AnscAsn1SignerInfosIsChildValid
    (
        ANSC_HANDLE                 hThisObject,
        ANSC_HANDLE                 hChild
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    PANSC_ASN1_OBJECT               pChild    = (PANSC_ASN1_OBJECT)hChild;

    if( pChild == NULL)
    {
        return ANSC_ASN1_NULL_OBJCET;
    }

    if( !AnscEqualString1(pChild->ClassName, "ANSC_ASN1_SIGNERINFO", TRUE))
    {
        return ANSC_ASN1_INVALID_TYPE_IN_SEQOF_OR_SETOF;
    }

    return ANSC_STATUS_SUCCESS;
}

/**********************************************************************

 OBJECT -- ANSC_ASN1_SIGNERINFO

 SignerInfo ::= Sequence 
     {
                           version Integer 
             issuerAndSerialNumber IssuerAndSerialNumber 
                   digestAlgorithm DigestAlgorithmIdentifier 
           authenticatedAttributes [CON 0] IMP Attributes OPT
         digestEncryptionAlgorithm DigestEncryptionAlgorithmIdentifier 
                   encryptedDigest EncryptedDigest 
         unauthenticatedAttributes [CON 1] IMP Attributes OPT
     }

 **********************************************************************/

ANSC_HANDLE 
AnscAsn1CreateSignerInfo
    (
        ANSC_HANDLE                 hReserved
    )
{
    UNREFERENCED_PARAMETER(hReserved);
    PANSC_ASN1_SIGNERINFO           pThisObject  = NULL;
    PANSC_ASN1_OBJECT               pChild;

    /*
     * Create the base ASN.1 object.
     */
    pThisObject = (PANSC_ASN1_SIGNERINFO)
        AnscAsn1CreateSequence
            (
                (ANSC_HANDLE)sizeof(ANSC_ASN1_SIGNERINFO)
            );

    if( pThisObject == NULL)
    {
        return (ANSC_HANDLE)NULL;
    }

    /*
     * Initialize the common variables and functions for this ASN.1 object.
     */
    pThisObject->SetClassName(pThisObject, "ANSC_ASN1_SIGNERINFO");
    pThisObject->SetName(pThisObject, "SignerInfo");

    pThisObject->Create             = AnscAsn1CreateSignerInfo;
    pThisObject->CreateChildAttr    = AnscAsn1SignerInfoCreateChildAttr;
    pThisObject->GetChildName       = AnscAsn1SignerInfoGetChildName;
    pThisObject->CreateChildObject  = AnscAsn1SignerInfoCreateChildObject;
    pThisObject->uTotalChild        = 7;

    /*
     * Create all the children
     */
    pThisObject->CreateAllChildren(pThisObject);

    /*
     *  Set some default values; 
     */
    pChild  = pThisObject->GetChildByIndex(pThisObject,0);

    if( pChild != NULL)
    {
        ((PANSC_ASN1_INTEGER)pChild)->SetIntegerValue(pChild, 1);
    }

    return (ANSC_HANDLE)pThisObject;
}

ANSC_HANDLE
AnscAsn1SignerInfoCreateChildObject
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    PANSC_ASN1_OBJECT               pThisObject      = NULL;
    PANSC_ASN1_SEQUENCE             pParent          = (PANSC_ASN1_SEQUENCE)hThisObject;

    switch( index )
    {

        case 0:

            pThisObject = AnscAsn1CreateInteger(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
                pThisObject->bCanBeOptional = TRUE;
                pThisObject->bOptional = TRUE;
            }

            break;

        case 1:

            pThisObject = AnscAsn1CreateIssuerAndSerialNumber(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
            }

            break;

        case 2:

            pThisObject = AnscAsn1CreateDigestAlgorithmIdentifier(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
            }

            break;

        case 3:

            pThisObject = AnscAsn1CreateAttributes(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
                pThisObject->bCanBeOptional = TRUE;
                pThisObject->bOptional = TRUE;
            }

            break;

        case 4:

            pThisObject = AnscAsn1CreateDigestEncryptionAlgorithmIdentifier(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
            }

            break;

        case 5:

            pThisObject = AnscAsn1CreateEncryptedDigest(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
            }

            break;

        case 6:

            pThisObject = AnscAsn1CreateAttributes(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
                pThisObject->bCanBeOptional = TRUE;
                pThisObject->bOptional = TRUE;
            }

            break;

    }

    return pThisObject;

}

PANSC_ATTR_OBJECT
AnscAsn1SignerInfoCreateChildAttr
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    PANSC_ATTR_OBJECT               pAttrObject  = NULL;

    switch ( index )
    {
        case 0:
        case 1:
        case 2:

                break;

        case 3:

                pAttrObject = (PANSC_ATTR_OBJECT)
                    AnscAsn1AttrCreate
                        (
                          CONTEXT_FORM,
                          0,
                          IMPLICIT_TYPE
                        );

                break;

        case 4:
        case 5:

                break;

        case 6:

                pAttrObject = (PANSC_ATTR_OBJECT)
                    AnscAsn1AttrCreate
                        (
                          CONTEXT_FORM,
                          1,
                          IMPLICIT_TYPE
                        );

                break;

    }

    return pAttrObject;

}

PCHAR
AnscAsn1SignerInfoGetChildName
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    switch ( index )
    {
        case 0:

            return"version";

        case 1:

            return"issuerAndSerialNumber";

        case 2:

            return"digestAlgorithm";

        case 3:

            return"authenticatedAttributes";

        case 4:

            return"digestEncryptionAlgorithm";

        case 5:

            return"encryptedDigest";

        case 6:

            return"unauthenticatedAttributes";

    }

    return "";

}


/**********************************************************************

 OBJECT -- ANSC_ASN1_ISSUERANDSERIALNUMBER

 IssuerAndSerialNumber ::= Sequence 
     {
                            issuer Name 
                      serialNumber Integer 
     }

 **********************************************************************/

ANSC_HANDLE 
AnscAsn1CreateIssuerAndSerialNumber
    (
        ANSC_HANDLE                 hReserved
    )
{
    UNREFERENCED_PARAMETER(hReserved);
    PANSC_ASN1_ISSUERANDSERIALNUMBER 
                                    pThisObject  = NULL;

    /*
     * Create the base ASN.1 object.
     */
    pThisObject = (PANSC_ASN1_ISSUERANDSERIALNUMBER)
        AnscAsn1CreateSequence
            (
                (ANSC_HANDLE)sizeof(ANSC_ASN1_ISSUERANDSERIALNUMBER)
            );

    if( pThisObject == NULL)
    {
        return (ANSC_HANDLE)NULL;
    }

    /*
     * Initialize the common variables and functions for this ASN.1 object.
     */
    pThisObject->SetClassName(pThisObject, "ANSC_ASN1_ISSUERANDSERIALNUMBER");
    pThisObject->SetName(pThisObject, "IssuerAndSerialNumber");

    pThisObject->Create             = AnscAsn1CreateIssuerAndSerialNumber;
    pThisObject->CreateChildAttr    = AnscAsn1IssuerAndSerialNumberCreateChildAttr;
    pThisObject->GetChildName       = AnscAsn1IssuerAndSerialNumberGetChildName;
    pThisObject->CreateChildObject  = AnscAsn1IssuerAndSerialNumberCreateChildObject;
    pThisObject->uTotalChild        = 2;

    /*
     * Create all the children
     */
    pThisObject->CreateAllChildren(pThisObject);


    return (ANSC_HANDLE)pThisObject;
}

ANSC_HANDLE
AnscAsn1IssuerAndSerialNumberCreateChildObject
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    PANSC_ASN1_OBJECT               pThisObject      = NULL;
    PANSC_ASN1_SEQUENCE             pParent          = (PANSC_ASN1_SEQUENCE)hThisObject;

    switch( index )
    {

        case 0:

            pThisObject = AnscAsn1CreateName(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
            }

            break;

        case 1:

            pThisObject = AnscAsn1CreateInteger(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
            }

            break;

    }

    return pThisObject;

}

PANSC_ATTR_OBJECT
AnscAsn1IssuerAndSerialNumberCreateChildAttr
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    UNREFERENCED_PARAMETER(index);
    PANSC_ATTR_OBJECT               pAttrObject  = NULL;

    return pAttrObject;

}

PCHAR
AnscAsn1IssuerAndSerialNumberGetChildName
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    switch ( index )
    {
        case 0:

            return"issuer";

        case 1:

            return"serialNumber";

    }

    return "";

}

/**********************************************************************

 OBJECT -- ANSC_ASN1_DIGESTENCRYPTIONALGORITHMIDENTIFIER

 DigestEncryptionAlgorithmIdentifier ::= AlgorithmIdentifier 

 **********************************************************************/

ANSC_HANDLE 
AnscAsn1CreateDigestEncryptionAlgorithmIdentifier
    (
        ANSC_HANDLE                 hReserved
    )
{
    PANSC_ASN1_DIGESTENCRYPTIONALGORITHMIDENTIFIER 
                                    pThisObject  = NULL;

    /*
     * Create the base ASN.1 object.
     */
    pThisObject = (PANSC_ASN1_DIGESTENCRYPTIONALGORITHMIDENTIFIER)
        AnscAsn1CreateAlgorithmIdentifier
            (
                hReserved
            );

    if( pThisObject == NULL)
    {
        return (ANSC_HANDLE)NULL;
    }

    /*
     * Initialize the common variables and functions for this ASN.1 object.
     */
    pThisObject->SetClassName(pThisObject, "ANSC_ASN1_DIGESTENCRYPTIONALGORITHMIDENTIFIER");
    pThisObject->SetName(pThisObject, "DigestEncryptionAlgorithmIdentifier");

    pThisObject->Create             = AnscAsn1CreateDigestEncryptionAlgorithmIdentifier;

    return (ANSC_HANDLE)pThisObject;
}

/**********************************************************************

 OBJECT -- ANSC_ASN1_ENCRYPTEDDIGEST

 EncryptedDigest ::= OctetString 

 **********************************************************************/

ANSC_HANDLE 
AnscAsn1CreateEncryptedDigest
    (
        ANSC_HANDLE                 hReserved
    )
{
    PANSC_ASN1_ENCRYPTEDDIGEST      pThisObject  = NULL;

    /*
     * Create the base ASN.1 object.
     */
    pThisObject = (PANSC_ASN1_ENCRYPTEDDIGEST)
        AnscAsn1CreateOctetString
            (
                hReserved
            );

    if( pThisObject == NULL)
    {
        return (ANSC_HANDLE)NULL;
    }

    /*
     * Initialize the common variables and functions for this ASN.1 object.
     */
    pThisObject->SetClassName(pThisObject, "ANSC_ASN1_ENCRYPTEDDIGEST");
    pThisObject->SetName(pThisObject, "EncryptedDigest");

    pThisObject->Create             = AnscAsn1CreateEncryptedDigest;

    return (ANSC_HANDLE)pThisObject;
}

/**********************************************************************

 OBJECT -- ANSC_ASN1_DIGESTINFO

 DigestInfo ::= Sequence 
     {
                         digestAlg DigestAlgorithmIdentifier 
                            digest OctetString 
     }

 **********************************************************************/

ANSC_HANDLE 
AnscAsn1CreateDigestInfo
    (
        ANSC_HANDLE                 hReserved
    )
{
    UNREFERENCED_PARAMETER(hReserved);
    PANSC_ASN1_DIGESTINFO           pThisObject  = NULL;

    /*
     * Create the base ASN.1 object.
     */
    pThisObject = (PANSC_ASN1_DIGESTINFO)
        AnscAsn1CreateSequence
            (
                (ANSC_HANDLE)sizeof(ANSC_ASN1_DIGESTINFO)
            );

    if( pThisObject == NULL)
    {
        return (ANSC_HANDLE)NULL;
    }

    /*
     * Initialize the common variables and functions for this ASN.1 object.
     */
    pThisObject->SetClassName(pThisObject, "ANSC_ASN1_DIGESTINFO");
    pThisObject->SetName(pThisObject, "DigestInfo");

    pThisObject->Create             = AnscAsn1CreateDigestInfo;
    pThisObject->CreateChildAttr    = AnscAsn1DigestInfoCreateChildAttr;
    pThisObject->GetChildName       = AnscAsn1DigestInfoGetChildName;
    pThisObject->CreateChildObject  = AnscAsn1DigestInfoCreateChildObject;
    pThisObject->uTotalChild        = 2;

    /*
     * Create all the children
     */
    pThisObject->CreateAllChildren(pThisObject);


    return (ANSC_HANDLE)pThisObject;
}

ANSC_HANDLE
AnscAsn1DigestInfoCreateChildObject
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    PANSC_ASN1_OBJECT               pThisObject      = NULL;
    PANSC_ASN1_SEQUENCE             pParent          = (PANSC_ASN1_SEQUENCE)hThisObject;

    switch( index )
    {

        case 0:

            pThisObject = AnscAsn1CreateDigestAlgorithmIdentifier(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
            }

            break;

        case 1:

            pThisObject = AnscAsn1CreateOctetString(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
            }

            break;

    }

    return pThisObject;

}

PANSC_ATTR_OBJECT
AnscAsn1DigestInfoCreateChildAttr
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    UNREFERENCED_PARAMETER(index);
    PANSC_ATTR_OBJECT               pAttrObject  = NULL;

    return pAttrObject;

}

PCHAR
AnscAsn1DigestInfoGetChildName
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    switch ( index )
    {
        case 0:

            return"digestAlg";

        case 1:

            return"digest";

    }

    return "";

}

/**********************************************************************

 OBJECT -- ANSC_ASN1_ENVELOPEDDATA

 EnvelopedData ::= Sequence 
     {
                           version Integer 
                    recipientInfos RecipientInfos 
              encryptedContentInfo EncryptedContentInfo 
     }

 **********************************************************************/

ANSC_HANDLE 
AnscAsn1CreateEnvelopedData
    (
        ANSC_HANDLE                 hReserved
    )
{
    UNREFERENCED_PARAMETER(hReserved);
    PANSC_ASN1_ENVELOPEDDATA        pThisObject  = NULL;

    /*
     * Create the base ASN.1 object.
     */
    pThisObject = (PANSC_ASN1_ENVELOPEDDATA)
        AnscAsn1CreateSequence
            (
                (ANSC_HANDLE)sizeof(ANSC_ASN1_ENVELOPEDDATA)
            );

    if( pThisObject == NULL)
    {
        return (ANSC_HANDLE)NULL;
    }

    /*
     * Initialize the common variables and functions for this ASN.1 object.
     */
    pThisObject->SetClassName(pThisObject, "ANSC_ASN1_ENVELOPEDDATA");
    pThisObject->SetName(pThisObject, "EnvelopedData");

    pThisObject->Create             = AnscAsn1CreateEnvelopedData;
    pThisObject->CreateChildAttr    = AnscAsn1EnvelopedDataCreateChildAttr;
    pThisObject->GetChildName       = AnscAsn1EnvelopedDataGetChildName;
    pThisObject->CreateChildObject  = AnscAsn1EnvelopedDataCreateChildObject;
    pThisObject->uTotalChild        = 3;

    /*
     * Create all the children
     */
    pThisObject->CreateAllChildren(pThisObject);


    return (ANSC_HANDLE)pThisObject;
}

ANSC_HANDLE
AnscAsn1EnvelopedDataCreateChildObject
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    PANSC_ASN1_OBJECT               pThisObject      = NULL;
    PANSC_ASN1_SEQUENCE             pParent          = (PANSC_ASN1_SEQUENCE)hThisObject;

    switch( index )
    {

        case 0:

            pThisObject = AnscAsn1CreateInteger(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
                pThisObject->bCanBeOptional = TRUE;
                pThisObject->bOptional = TRUE;
            }

            break;

        case 1:

            pThisObject = AnscAsn1CreateRecipientInfos(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
            }

            break;

        case 2:

            pThisObject = AnscAsn1CreateEncryptedContentInfo(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
            }

            break;

    }

    return pThisObject;

}

PANSC_ATTR_OBJECT
AnscAsn1EnvelopedDataCreateChildAttr
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    UNREFERENCED_PARAMETER(index);
    PANSC_ATTR_OBJECT               pAttrObject  = NULL;

    return pAttrObject;

}

PCHAR
AnscAsn1EnvelopedDataGetChildName
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    switch ( index )
    {
        case 0:

            return"version";

        case 1:

            return"recipientInfos";

        case 2:

            return"encryptedContentInfo";

    }

    return "";

}

/**********************************************************************

 OBJECT -- ANSC_ASN1_RECIPIENTINFOS

 RecipientInfos ::= SetOf RecipientInfo  {}

 **********************************************************************/

ANSC_HANDLE 
AnscAsn1CreateRecipientInfos
    (
        ANSC_HANDLE                 hReserved
    )
{
    PANSC_ASN1_RECIPIENTINFOS       pThisObject  = NULL;

    /*
     * Create the base ASN.1 object.
     */
    pThisObject = (PANSC_ASN1_RECIPIENTINFOS)
        AnscAsn1CreateSetOf
            (
                hReserved
            );

    if( pThisObject == NULL)
    {
        return (ANSC_HANDLE)NULL;
    }

    /*
     * Initialize the common variables and functions for this ASN.1 object.
     */
    pThisObject->SetClassName(pThisObject, "ANSC_ASN1_RECIPIENTINFOS");
    pThisObject->SetName(pThisObject, "RecipientInfos");

    pThisObject->Create             = AnscAsn1CreateRecipientInfos;
    pThisObject->CreateChild        = AnscAsn1RecipientInfosCreateChild;
    pThisObject->IsChildValid       = AnscAsn1RecipientInfosIsChildValid;

    return (ANSC_HANDLE)pThisObject;
}

ANSC_HANDLE
AnscAsn1RecipientInfosCreateChild
    (
        ANSC_HANDLE                 hThisObject,
        BOOLEAN                     bAddItIn
    )
{
    PANSC_ASN1_SETOF                pParentObj   = (PANSC_ASN1_SETOF)hThisObject;
    PANSC_ASN1_OBJECT               pThisObject  = NULL;

    pThisObject  = AnscAsn1CreateRecipientInfo(NULL);

    if( pThisObject != NULL && bAddItIn)
    {
        pParentObj->AddChild(pParentObj,pThisObject);
    }

    return pThisObject;
}

ANSC_STATUS
AnscAsn1RecipientInfosIsChildValid
    (
        ANSC_HANDLE                 hThisObject,
        ANSC_HANDLE                 hChild
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    PANSC_ASN1_OBJECT               pChild    = (PANSC_ASN1_OBJECT)hChild;

    if( pChild == NULL)
    {
        return ANSC_ASN1_NULL_OBJCET;
    }

    if( !AnscEqualString1(pChild->ClassName, "ANSC_ASN1_RECIPIENTINFO", TRUE))
    {
        return ANSC_ASN1_INVALID_TYPE_IN_SEQOF_OR_SETOF;
    }

    return ANSC_STATUS_SUCCESS;
}

/**********************************************************************

 OBJECT -- ANSC_ASN1_ENCRYPTEDCONTENTINFO

 EncryptedContentInfo ::= Sequence 
     {
                       contentType OID 
        contentEncryptionAlgorithm EncryptionAlgorithmIdentifier 
                           content [CON 0] IMP EncryptedContent OPT
     }

 **********************************************************************/

ANSC_HANDLE 
AnscAsn1CreateEncryptedContentInfo
    (
        ANSC_HANDLE                 hReserved
    )
{
    UNREFERENCED_PARAMETER(hReserved);
    PANSC_ASN1_ENCRYPTEDCONTENTINFO pThisObject  = NULL;

    /*
     * Create the base ASN.1 object.
     */
    pThisObject = (PANSC_ASN1_ENCRYPTEDCONTENTINFO)
        AnscAsn1CreateSequence
            (
                (ANSC_HANDLE)sizeof(ANSC_ASN1_ENCRYPTEDCONTENTINFO)
            );

    if( pThisObject == NULL)
    {
        return (ANSC_HANDLE)NULL;
    }

    /*
     * Initialize the common variables and functions for this ASN.1 object.
     */
    pThisObject->SetClassName(pThisObject, "ANSC_ASN1_ENCRYPTEDCONTENTINFO");
    pThisObject->SetName(pThisObject, "EncryptedContentInfo");

    pThisObject->Create             = AnscAsn1CreateEncryptedContentInfo;
    pThisObject->CreateChildAttr    = AnscAsn1EncryptedContentInfoCreateChildAttr;
    pThisObject->GetChildName       = AnscAsn1EncryptedContentInfoGetChildName;
    pThisObject->CreateChildObject  = AnscAsn1EncryptedContentInfoCreateChildObject;
    pThisObject->uTotalChild        = 3;

    /*
     * Create all the children
     */
    pThisObject->CreateAllChildren(pThisObject);


    return (ANSC_HANDLE)pThisObject;
}

ANSC_HANDLE
AnscAsn1EncryptedContentInfoCreateChildObject
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    PANSC_ASN1_OBJECT               pThisObject      = NULL;
    PANSC_ASN1_SEQUENCE             pParent          = (PANSC_ASN1_SEQUENCE)hThisObject;

    switch( index )
    {

        case 0:

            pThisObject = AnscAsn1CreateOID(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
            }

            break;

        case 1:

            pThisObject = AnscAsn1CreateEncryptionAlgorithmIdentifier(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
            }

            break;

        case 2:

            pThisObject = AnscAsn1CreateEncryptedContent(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
                pThisObject->bCanBeOptional = TRUE;
                pThisObject->bOptional = TRUE;
            }

            break;

    }

    return pThisObject;

}

PANSC_ATTR_OBJECT
AnscAsn1EncryptedContentInfoCreateChildAttr
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    PANSC_ATTR_OBJECT               pAttrObject  = NULL;

    switch ( index )
    {
        case 0:
        case 1:

                break;

        case 2:

                pAttrObject = (PANSC_ATTR_OBJECT)
                    AnscAsn1AttrCreate
                        (
                          CONTEXT_FORM,
                          0,
                          IMPLICIT_TYPE
                        );

                break;

    }

    return pAttrObject;

}

PCHAR
AnscAsn1EncryptedContentInfoGetChildName
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    switch ( index )
    {
        case 0:

            return"contentType";

        case 1:

            return"contentEncryptionAlgorithm";

        case 2:

            return"content";

    }

    return "";

}

/**********************************************************************

 OBJECT -- ANSC_ASN1_RECIPIENTINFO

 RecipientInfo ::= Sequence 
     {
                           version Integer 
              issuerAndSerialNumer IssuerAndSerialNumber 
            keyEncryptionAlgorithm EncryptionAlgorithmIdentifier 
                      encryptedKey PKCS7EncryptedKey 
     }

 **********************************************************************/

ANSC_HANDLE 
AnscAsn1CreateRecipientInfo
    (
        ANSC_HANDLE                 hReserved
    )
{
    UNREFERENCED_PARAMETER(hReserved);
    PANSC_ASN1_RECIPIENTINFO        pThisObject  = NULL;

    /*
     * Create the base ASN.1 object.
     */
    pThisObject = (PANSC_ASN1_RECIPIENTINFO)
        AnscAsn1CreateSequence
            (
                (ANSC_HANDLE)sizeof(ANSC_ASN1_RECIPIENTINFO)
            );

    if( pThisObject == NULL)
    {
        return (ANSC_HANDLE)NULL;
    }

    /*
     * Initialize the common variables and functions for this ASN.1 object.
     */
    pThisObject->SetClassName(pThisObject, "ANSC_ASN1_RECIPIENTINFO");
    pThisObject->SetName(pThisObject, "RecipientInfo");

    pThisObject->Create             = AnscAsn1CreateRecipientInfo;
    pThisObject->CreateChildAttr    = AnscAsn1RecipientInfoCreateChildAttr;
    pThisObject->GetChildName       = AnscAsn1RecipientInfoGetChildName;
    pThisObject->CreateChildObject  = AnscAsn1RecipientInfoCreateChildObject;
    pThisObject->uTotalChild        = 4;

    /*
     * Create all the children
     */
    pThisObject->CreateAllChildren(pThisObject);


    return (ANSC_HANDLE)pThisObject;
}

ANSC_HANDLE
AnscAsn1RecipientInfoCreateChildObject
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    PANSC_ASN1_OBJECT               pThisObject      = NULL;
    PANSC_ASN1_SEQUENCE             pParent          = (PANSC_ASN1_SEQUENCE)hThisObject;

    switch( index )
    {

        case 0:

            pThisObject = AnscAsn1CreateInteger(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
                pThisObject->bCanBeOptional = TRUE;
                pThisObject->bOptional = TRUE;
            }

            break;

        case 1:

            pThisObject = AnscAsn1CreateIssuerAndSerialNumber(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
            }

            break;

        case 2:

            pThisObject = AnscAsn1CreateEncryptionAlgorithmIdentifier(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
            }

            break;

        case 3:

            pThisObject = AnscAsn1CreatePKCS7EncryptedKey(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
            }

            break;

    }

    return pThisObject;

}

PANSC_ATTR_OBJECT
AnscAsn1RecipientInfoCreateChildAttr
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    UNREFERENCED_PARAMETER(index);
    PANSC_ATTR_OBJECT               pAttrObject  = NULL;

    return pAttrObject;

}

PCHAR
AnscAsn1RecipientInfoGetChildName
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    switch ( index )
    {
        case 0:

            return"version";

        case 1:

            return"issuerAndSerialNumer";

        case 2:

            return"keyEncryptionAlgorithm";

        case 3:

            return"encryptedKey";

    }

    return "";

}

/**********************************************************************

 OBJECT -- ANSC_ASN1_ENCRYPTEDCONTENT

 EncryptedContent ::= OctetString 

 **********************************************************************/

ANSC_HANDLE 
AnscAsn1CreateEncryptedContent
    (
        ANSC_HANDLE                 hReserved
    )
{
    PANSC_ASN1_ENCRYPTEDCONTENT     pThisObject  = NULL;

    /*
     * Create the base ASN.1 object.
     */
    pThisObject = (PANSC_ASN1_ENCRYPTEDCONTENT)
        AnscAsn1CreateOctetString
            (
                hReserved
            );

    if( pThisObject == NULL)
    {
        return (ANSC_HANDLE)NULL;
    }

    /*
     * Initialize the common variables and functions for this ASN.1 object.
     */
    pThisObject->SetClassName(pThisObject, "ANSC_ASN1_ENCRYPTEDCONTENT");
    pThisObject->SetName(pThisObject, "EncryptedContent");

    pThisObject->Create             = AnscAsn1CreateEncryptedContent;

    return (ANSC_HANDLE)pThisObject;
}

/**********************************************************************

 OBJECT -- ANSC_ASN1_PKCS7ENCRYPTEDKEY

 PKCS7EncryptedKey ::= OctetString 

 **********************************************************************/

ANSC_HANDLE 
AnscAsn1CreatePKCS7EncryptedKey
    (
        ANSC_HANDLE                 hReserved
    )
{
    PANSC_ASN1_PKCS7ENCRYPTEDKEY    pThisObject  = NULL;

    /*
     * Create the base ASN.1 object.
     */
    pThisObject = (PANSC_ASN1_PKCS7ENCRYPTEDKEY)
        AnscAsn1CreateOctetString
            (
                hReserved
            );

    if( pThisObject == NULL)
    {
        return (ANSC_HANDLE)NULL;
    }

    /*
     * Initialize the common variables and functions for this ASN.1 object.
     */
    pThisObject->SetClassName(pThisObject, "ANSC_ASN1_PKCS7ENCRYPTEDKEY");
    pThisObject->SetName(pThisObject, "PKCS7EncryptedKey");

    pThisObject->Create             = AnscAsn1CreatePKCS7EncryptedKey;

    return (ANSC_HANDLE)pThisObject;
}

/**********************************************************************

 OBJECT -- ANSC_ASN1_SIGNEDANDENVELOPEDDATA

 SignedAndEnvelopedData ::= Sequence 
     {
                           version Integer 
                    recipientInfos RecipientInfos 
                  digestAlgorithms DigestAlgorithmIdentifiers 
              encryptedContentInfo EncryptedContentInfo 
                      certificates [CON 0] IMP Certificates OPT
                              crls [CON 1] IMP CertificateRevocationLists OPT
                       signerInfos SignerInfos 
     }

 **********************************************************************/

ANSC_HANDLE 
AnscAsn1CreateSignedAndEnvelopedData
    (
        ANSC_HANDLE                 hReserved
    )
{
    UNREFERENCED_PARAMETER(hReserved);
    PANSC_ASN1_SIGNEDANDENVELOPEDDATA 
                                    pThisObject  = NULL;

    /*
     * Create the base ASN.1 object.
     */
    pThisObject = (PANSC_ASN1_SIGNEDANDENVELOPEDDATA)
        AnscAsn1CreateSequence
            (
                (ANSC_HANDLE)sizeof(ANSC_ASN1_SIGNEDANDENVELOPEDDATA)
            );

    if( pThisObject == NULL)
    {
        return (ANSC_HANDLE)NULL;
    }

    /*
     * Initialize the common variables and functions for this ASN.1 object.
     */
    pThisObject->SetClassName(pThisObject, "ANSC_ASN1_SIGNEDANDENVELOPEDDATA");
    pThisObject->SetName(pThisObject, "SignedAndEnvelopedData");

    pThisObject->Create             = AnscAsn1CreateSignedAndEnvelopedData;
    pThisObject->CreateChildAttr    = AnscAsn1SignedAndEnvelopedDataCreateChildAttr;
    pThisObject->GetChildName       = AnscAsn1SignedAndEnvelopedDataGetChildName;
    pThisObject->CreateChildObject  = AnscAsn1SignedAndEnvelopedDataCreateChildObject;
    pThisObject->uTotalChild        = 7;

    /*
     * Create all the children
     */
    pThisObject->CreateAllChildren(pThisObject);


    return (ANSC_HANDLE)pThisObject;
}

ANSC_HANDLE
AnscAsn1SignedAndEnvelopedDataCreateChildObject
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    PANSC_ASN1_OBJECT               pThisObject      = NULL;
    PANSC_ASN1_SEQUENCE             pParent          = (PANSC_ASN1_SEQUENCE)hThisObject;

    switch( index )
    {

        case 0:

            pThisObject = AnscAsn1CreateInteger(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
                pThisObject->bCanBeOptional = TRUE;
                pThisObject->bOptional = TRUE;
            }

            break;

        case 1:

            pThisObject = AnscAsn1CreateRecipientInfos(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
            }

            break;

        case 2:

            pThisObject = AnscAsn1CreateDigestAlgorithmIdentifiers(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
            }

            break;

        case 3:

            pThisObject = AnscAsn1CreateEncryptedContentInfo(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
            }

            break;

        case 4:

            pThisObject = AnscAsn1CreateCertificates(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
                pThisObject->bCanBeOptional = TRUE;
                pThisObject->bOptional = TRUE;
            }

            break;

        case 5:

            pThisObject = AnscAsn1CreateCertificateRevocationLists(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
                pThisObject->bCanBeOptional = TRUE;
                pThisObject->bOptional = TRUE;
            }

            break;

        case 6:

            pThisObject = AnscAsn1CreateSignerInfos(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
            }

            break;

    }

    return pThisObject;

}

PANSC_ATTR_OBJECT
AnscAsn1SignedAndEnvelopedDataCreateChildAttr
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    PANSC_ATTR_OBJECT               pAttrObject  = NULL;

    switch ( index )
    {
        case 0:
        case 1:
        case 2:
        case 3:

                break;

        case 4:

                pAttrObject = (PANSC_ATTR_OBJECT)
                    AnscAsn1AttrCreate
                        (
                          CONTEXT_FORM,
                          0,
                          IMPLICIT_TYPE
                        );

                break;

        case 5:

                pAttrObject = (PANSC_ATTR_OBJECT)
                    AnscAsn1AttrCreate
                        (
                          CONTEXT_FORM,
                          1,
                          IMPLICIT_TYPE
                        );

                break;

        case 6:

                break;

    }

    return pAttrObject;

}

PCHAR
AnscAsn1SignedAndEnvelopedDataGetChildName
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    switch ( index )
    {
        case 0:

            return"version";

        case 1:

            return"recipientInfos";

        case 2:

            return"digestAlgorithms";

        case 3:

            return"encryptedContentInfo";

        case 4:

            return"certificates";

        case 5:

            return"crls";

        case 6:

            return"signerInfos";

    }

    return "";

}

/**********************************************************************

 OBJECT -- ANSC_ASN1_DIGESTEDDATA

 DigestedData ::= Sequence 
     {
                           version Integer 
                   digestAlgorithm DigestAlgorithmIdentifier 
                       contentInfo ContentInfo 
                            digest Digest 
     }

 **********************************************************************/

ANSC_HANDLE 
AnscAsn1CreateDigestedData
    (
        ANSC_HANDLE                 hReserved
    )
{
    UNREFERENCED_PARAMETER(hReserved);
    PANSC_ASN1_DIGESTEDDATA         pThisObject  = NULL;

    /*
     * Create the base ASN.1 object.
     */
    pThisObject = (PANSC_ASN1_DIGESTEDDATA)
        AnscAsn1CreateSequence
            (
                (ANSC_HANDLE)sizeof(ANSC_ASN1_DIGESTEDDATA)
            );

    if( pThisObject == NULL)
    {
        return (ANSC_HANDLE)NULL;
    }

    /*
     * Initialize the common variables and functions for this ASN.1 object.
     */
    pThisObject->SetClassName(pThisObject, "ANSC_ASN1_DIGESTEDDATA");
    pThisObject->SetName(pThisObject, "DigestedData");

    pThisObject->Create             = AnscAsn1CreateDigestedData;
    pThisObject->CreateChildAttr    = AnscAsn1DigestedDataCreateChildAttr;
    pThisObject->GetChildName       = AnscAsn1DigestedDataGetChildName;
    pThisObject->CreateChildObject  = AnscAsn1DigestedDataCreateChildObject;
    pThisObject->uTotalChild        = 4;

    /*
     * Create all the children
     */
    pThisObject->CreateAllChildren(pThisObject);


    return (ANSC_HANDLE)pThisObject;
}

ANSC_HANDLE
AnscAsn1DigestedDataCreateChildObject
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    PANSC_ASN1_OBJECT               pThisObject      = NULL;
    PANSC_ASN1_SEQUENCE             pParent          = (PANSC_ASN1_SEQUENCE)hThisObject;

    switch( index )
    {

        case 0:

            pThisObject = AnscAsn1CreateInteger(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
                pThisObject->bCanBeOptional = TRUE;
                pThisObject->bOptional = TRUE;
            }

            break;

        case 1:

            pThisObject = AnscAsn1CreateDigestAlgorithmIdentifier(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
            }

            break;

        case 2:

            pThisObject = AnscAsn1CreateContentInfo(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
            }

            break;

        case 3:

            pThisObject = AnscAsn1CreateDigest(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
            }

            break;

    }

    return pThisObject;

}

PANSC_ATTR_OBJECT
AnscAsn1DigestedDataCreateChildAttr
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    UNREFERENCED_PARAMETER(index);
    PANSC_ATTR_OBJECT               pAttrObject  = NULL;

    return pAttrObject;

}

PCHAR
AnscAsn1DigestedDataGetChildName
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    switch ( index )
    {
        case 0:

            return"version";

        case 1:

            return"digestAlgorithm";

        case 2:

            return"contentInfo";

        case 3:

            return"digest";

    }

    return "";

}


/**********************************************************************

 OBJECT -- ANSC_ASN1_DIGEST

 Digest ::= OctetString 

 **********************************************************************/

ANSC_HANDLE 
AnscAsn1CreateDigest
    (
        ANSC_HANDLE                 hReserved
    )
{
    PANSC_ASN1_DIGEST               pThisObject  = NULL;

    /*
     * Create the base ASN.1 object.
     */
    pThisObject = (PANSC_ASN1_DIGEST)
        AnscAsn1CreateOctetString
            (
                hReserved
            );

    if( pThisObject == NULL)
    {
        return (ANSC_HANDLE)NULL;
    }

    /*
     * Initialize the common variables and functions for this ASN.1 object.
     */
    pThisObject->SetClassName(pThisObject, "ANSC_ASN1_DIGEST");
    pThisObject->SetName(pThisObject, "Digest");

    pThisObject->Create             = AnscAsn1CreateDigest;

    return (ANSC_HANDLE)pThisObject;
}

/**********************************************************************

 OBJECT -- ANSC_ASN1_ENCRYPTEDDATA

 EncryptedData ::= Sequence 
     {
                           version Integer 
              encryptedContentInfo EncryptedContentInfo 
     }

 **********************************************************************/

ANSC_HANDLE 
AnscAsn1CreateEncryptedData
    (
        ANSC_HANDLE                 hReserved
    )
{
    UNREFERENCED_PARAMETER(hReserved);
    PANSC_ASN1_ENCRYPTEDDATA        pThisObject  = NULL;

    /*
     * Create the base ASN.1 object.
     */
    pThisObject = (PANSC_ASN1_ENCRYPTEDDATA)
        AnscAsn1CreateSequence
            (
                (ANSC_HANDLE)sizeof(ANSC_ASN1_ENCRYPTEDDATA)
            );

    if( pThisObject == NULL)
    {
        return (ANSC_HANDLE)NULL;
    }

    /*
     * Initialize the common variables and functions for this ASN.1 object.
     */
    pThisObject->SetClassName(pThisObject, "ANSC_ASN1_ENCRYPTEDDATA");
    pThisObject->SetName(pThisObject, "EncryptedData");

    pThisObject->Create             = AnscAsn1CreateEncryptedData;
    pThisObject->CreateChildAttr    = AnscAsn1EncryptedDataCreateChildAttr;
    pThisObject->GetChildName       = AnscAsn1EncryptedDataGetChildName;
    pThisObject->CreateChildObject  = AnscAsn1EncryptedDataCreateChildObject;
    pThisObject->uTotalChild        = 2;

    /*
     * Create all the children
     */
    pThisObject->CreateAllChildren(pThisObject);


    return (ANSC_HANDLE)pThisObject;
}

ANSC_HANDLE
AnscAsn1EncryptedDataCreateChildObject
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    PANSC_ASN1_OBJECT               pThisObject      = NULL;
    PANSC_ASN1_SEQUENCE             pParent          = (PANSC_ASN1_SEQUENCE)hThisObject;

    switch( index )
    {

        case 0:

            pThisObject = AnscAsn1CreateInteger(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
            }

            break;

        case 1:

            pThisObject = AnscAsn1CreateEncryptedContentInfo(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateChildAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetChildName(pParent,index));
            }

            break;

    }

    return pThisObject;

}

PANSC_ATTR_OBJECT
AnscAsn1EncryptedDataCreateChildAttr
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    UNREFERENCED_PARAMETER(index);
    PANSC_ATTR_OBJECT               pAttrObject  = NULL;


    return pAttrObject;

}

PCHAR
AnscAsn1EncryptedDataGetChildName
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    switch ( index )
    {
        case 0:

            return"version";

        case 1:

            return"encryptedContentInfo";

    }

    return "";

}

/**********************************************************************

 OBJECT -- ANSC_ASN1_CONTENTDATA

 ContentData ::= Choice 
     {
                              data Data 
                        signedData SignedData 
                      envelopeData EnvelopedData 
            signedAndEnvelopedData SignedAndEnvelopedData 
                        digestData DigestedData 
                     encryptedData EncryptedData 
                          authPack Kb5_AuthPack 
                         dhKeyInfo Kb5_KdcDHKeyInfo 
                      replyKeyPack Kb5_ReplyKeyPack 
     }

 **********************************************************************/

ANSC_HANDLE 
AnscAsn1CreateContentData
    (
        ANSC_HANDLE                 hReserved
    )
{
    PANSC_ASN1_CONTENTDATA          pThisObject  = NULL;

    /*
     * Create the base ASN.1 object.
     */
    pThisObject = (PANSC_ASN1_CONTENTDATA)
        AnscAsn1CreateChoice
            (
                hReserved
            );

    if( pThisObject == NULL)
    {
        return (ANSC_HANDLE)NULL;
    }

    /*
     * Initialize the common variables and functions for this ASN.1 object.
     */
    pThisObject->SetClassName(pThisObject, "ANSC_ASN1_CONTENTDATA");
    pThisObject->SetName(pThisObject, "ContentData");

    pThisObject->Create             = AnscAsn1CreateContentData;
    pThisObject->CreateSelection    = AnscAsn1ContentDataCreateSelection;
    pThisObject->GetSelectionName   = AnscAsn1ContentDataGetSelectionName;
    pThisObject->CreateSelectionAttr= AnscAsn1ContentDataCreateSelectionAttr;
    pThisObject->GetChoiceFromOID   = AnscAsn1ContentDataGetChoiceByOID;
    pThisObject->GetOIDValueByMask  = AnscAsn1ContentDataGetOIDValueByMask;
    pThisObject->uTotalChoice       = CONTENTDATA_MAXI_MASK + 1;
    pThisObject->bChoiceByOID       = TRUE;

    return (ANSC_HANDLE)pThisObject;
}

ANSC_HANDLE
AnscAsn1ContentDataCreateSelection
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       index
    )
{
    PANSC_ASN1_OBJECT               pThisObject      = NULL;
    PANSC_ASN1_CHOICE               pParent         = (PANSC_ASN1_CHOICE)hThisObject;

    switch( index )
    {
        case CONTENTDATA_MASK_SIGNEDDATA:

            pThisObject = AnscAsn1CreateSignedData(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateSelectionAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetSelectionName(pParent,index));
            }

            break;

        case CONTENTDATA_MASK_ENVELOPEDATA:

            pThisObject = AnscAsn1CreateEnvelopedData(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateSelectionAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetSelectionName(pParent,index));
            }

            break;

        case CONTENTDATA_MASK_SIGNEDANDENVELOPEDDATA:

            pThisObject = AnscAsn1CreateSignedAndEnvelopedData(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateSelectionAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetSelectionName(pParent,index));
            }

            break;

        case CONTENTDATA_MASK_DIGESTDATA:

            pThisObject = AnscAsn1CreateDigestedData(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateSelectionAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetSelectionName(pParent,index));
            }

            break;

        case CONTENTDATA_MASK_ENCRYPTEDDATA:

            pThisObject = AnscAsn1CreateEncryptedData(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateSelectionAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetSelectionName(pParent,index));
            }

            break;

        case CONTENTDATA_MASK_AUTHPACK:
        case CONTENTDATA_MASK_DHKEYINFO:
        case CONTENTDATA_MASK_REPLYKEYPACK:
        case CONTENTDATA_MASK_DATA:

            pThisObject = AnscAsn1CreateData(NULL);

            if( pThisObject != NULL)
            {
                pThisObject->AddAttribute(pThisObject, pParent->CreateSelectionAttr(pParent,index), FALSE);
                pThisObject->SetName(pThisObject, pParent->GetSelectionName(pParent,index));
            }

            break;
    }

    return pThisObject;

}

PCHAR
AnscAsn1ContentDataGetSelectionName
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       selType
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    switch ( selType )
    {
        case CONTENTDATA_MASK_DATA:

            return"data";

        case CONTENTDATA_MASK_SIGNEDDATA:

            return"signedData";

        case CONTENTDATA_MASK_ENVELOPEDATA:

            return"envelopeData";

        case CONTENTDATA_MASK_SIGNEDANDENVELOPEDDATA:

            return"signedAndEnvelopedData";

        case CONTENTDATA_MASK_DIGESTDATA:

            return"digestData";

        case CONTENTDATA_MASK_ENCRYPTEDDATA:

            return"encryptedData";

        case CONTENTDATA_MASK_AUTHPACK:

            return"authPack";

        case CONTENTDATA_MASK_DHKEYINFO:

            return"dhKeyInfo";

        case CONTENTDATA_MASK_REPLYKEYPACK:

            return"replyKeyPack";
    }

    return "";

}

PANSC_ATTR_OBJECT
AnscAsn1ContentDataCreateSelectionAttr
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       selType
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    UNREFERENCED_PARAMETER(selType);
    PANSC_ATTR_OBJECT               pAttrObject  = NULL;

    return pAttrObject;

}

LONG
AnscAsn1ContentDataGetChoiceByOID
    (
        ANSC_HANDLE                 hThisObject,
        PCHAR                       pOIDString
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    if( pOIDString == NULL)         return -1;

    if( AnscEqualString1(pOIDString,"1.2.840.113549.1.7.1",FALSE))
    {
        return CONTENTDATA_MASK_DATA;
    }
    else if( AnscEqualString1(pOIDString,"1.2.840.113549.1.7.2",FALSE))
    {
        return CONTENTDATA_MASK_SIGNEDDATA;
    }
    else if( AnscEqualString1(pOIDString,"1.2.840.113549.1.7.3",FALSE))
    {
        return CONTENTDATA_MASK_ENVELOPEDATA;
    }
    else if( AnscEqualString1(pOIDString,"1.2.840.113549.1.7.4",FALSE))
    {
        return CONTENTDATA_MASK_SIGNEDANDENVELOPEDDATA;
    }
    else if( AnscEqualString1(pOIDString,"1.2.840.113549.1.7.5",FALSE))
    {
        return CONTENTDATA_MASK_DIGESTDATA;
    }
    else if( AnscEqualString1(pOIDString,"1.2.840.113549.1.7.6",FALSE))
    {
        return CONTENTDATA_MASK_ENCRYPTEDDATA;
    }
    else if( AnscEqualString1(pOIDString,"1.3.6.1.5.2.3.1",FALSE))
    {
        return CONTENTDATA_MASK_AUTHPACK;
    }
    else if( AnscEqualString1(pOIDString,"1.3.6.1.5.2.3.2",FALSE))
    {
        return CONTENTDATA_MASK_DHKEYINFO;
    }
    else if( AnscEqualString1(pOIDString,"1.3.6.1.5.2.3.3",FALSE))
    {
        return CONTENTDATA_MASK_REPLYKEYPACK;
    }

    return -1;

}

PCHAR
AnscAsn1ContentDataGetOIDValueByMask
    (
        ANSC_HANDLE                 hThisObject,
        ULONG                       selType
    )
{
    UNREFERENCED_PARAMETER(hThisObject);
    switch ( selType )
    {
        case CONTENTDATA_MASK_DATA:

             return "1.2.840.113549.1.7.1";

        case CONTENTDATA_MASK_SIGNEDDATA:

             return "1.2.840.113549.1.7.2";

        case CONTENTDATA_MASK_ENVELOPEDATA:

             return "1.2.840.113549.1.7.3";

        case CONTENTDATA_MASK_SIGNEDANDENVELOPEDDATA:

             return "1.2.840.113549.1.7.4";

        case CONTENTDATA_MASK_DIGESTDATA:

             return "1.2.840.113549.1.7.5";

        case CONTENTDATA_MASK_ENCRYPTEDDATA:

             return "1.2.840.113549.1.7.6";

        case CONTENTDATA_MASK_AUTHPACK:

             return "1.3.6.1.5.2.3.1";

        case CONTENTDATA_MASK_DHKEYINFO:

             return "1.3.6.1.5.2.3.2";

        case CONTENTDATA_MASK_REPLYKEYPACK:

             return "1.3.6.1.5.2.3.3";
    }

    return NULL;

}

